<!DOCTYPE html>
<html>
<head>
    <title>HarbourX - Complete System Design & Architecture</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            border-bottom: 3px solid #eee;
            margin-bottom: 30px;
            gap: 0;
        }
        .tab-button {
            background: #f8f9fa;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
            color: #6c757d;
        }
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .tab-button:hover:not(.active) {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* Common Styles */
        h1 {
            color: #2c3e50;
            text-align: center;
            font-size: 2.5em;
            padding-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            margin-bottom: 0;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 4px solid #667eea;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }
        .feature-card h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .database-table {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .database-table h4 {
            margin-top: 0;
            color: #495057;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        .field-list {
            list-style: none;
            padding: 0;
        }
        .field-list li {
            padding: 5px 0;
            border-bottom: 1px solid #f1f3f5;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        .tech-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }
        .timeline {
            position: relative;
            padding-left: 40px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #667eea;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -30px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }
        .status-complete {
            background: #d4edda;
            color: #155724;
        }
        .status-in-progress {
            background: #fff3cd;
            color: #856404;
        }
        .status-pending {
            background: #f8d7da;
            color: #721c24;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        .alert-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }
        .diagram-container {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .summary-box {
            background: #e8f6f3;
            border-left: 4px solid #16a085;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .domain-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .domain-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .user-domain {
            border-top: 4px solid #3498db;
        }
        .business-domain {
            border-top: 4px solid #27ae60;
        }
        .explanation-box {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            min-height: 500px;
            overflow-x: auto;
            overflow-y: hidden;
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
        }
        .mermaid svg {
            max-width: 100%;
            height: auto;
            min-width: 100%;
        }
        .mermaid a {
            color: #1976d2;
            text-decoration: underline;
            font-size: 10px;
        }
        
        /* Responsive improvements */
        @media (max-width: 1200px) {
            .mermaid {
                min-height: 450px;
                padding: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .mermaid {
                min-height: 350px;
                padding: 10px;
                overflow-x: scroll;
            }
            .mermaid svg {
                min-width: 320px;
                font-size: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .mermaid {
                min-height: 300px;
                padding: 8px;
            }
            .mermaid svg {
                min-width: 280px;
                font-size: 10px;
            }
        }
        
        /* Additional responsive improvements */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                border-radius: 15px;
            }
            h1 {
                font-size: 2em;
            }
            .tabs {
                flex-direction: column;
                gap: 5px;
            }
            .tab-button {
                text-align: center;
                margin-right: 0;
                border-radius: 8px;
            }
            .feature-grid {
                grid-template-columns: 1fr;
            }
            .domain-grid {
                grid-template-columns: 1fr;
            }
            .section {
                padding: 15px;
            }
            .diagram-container {
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 1.8em;
                padding-bottom: 15px;
            }
            h2 {
                font-size: 1.4em;
            }
            h3 {
                font-size: 1.2em;
            }
            .section {
                padding: 12px;
                margin: 15px 0;
            }
            .feature-card, .domain-card {
                padding: 15px;
            }
            .tab-button {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö¢ HarbourX - Complete System Design & Architecture</h1>
        
        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'feature-design')">üéØ Feature Design</button>
            <button class="tab-button" onclick="openTab(event, 'database-design')">üóÑÔ∏è Database Design</button>
        </div>

        <!-- Database Design Tab -->
        <div id="database-design" class="tab-content">
            
            <h2>üíæ Database Schema - Complete Design</h2>
            <div class="section">
                <h3>Core User & Identity System</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>users</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>email: VARCHAR UNIQUE</li>
                            <li>username: VARCHAR UNIQUE</li>
                            <li>first_name: VARCHAR</li>
                            <li>last_name: VARCHAR</li>
                            <li>phone: VARCHAR</li>
                            <li>password_hash: VARCHAR</li>
                            <li>professional_info: JSONB</li>
                            <li>avatar_url: VARCHAR</li>
                            <li>preferences: JSONB</li>
                            <li>is_email_verified: BOOLEAN</li>
                            <li>is_active: BOOLEAN</li>
                            <li>last_login: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>roles</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>name: VARCHAR UNIQUE</li>
                            <li>description: TEXT</li>
                            <li>properties: JSONB</li>
                            <li>config: JSONB</li>
                            <li>parent_role_id: INT REFERENCES roles</li>
                            <li>is_system_role: BOOLEAN</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>permissions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>resource: VARCHAR</li>
                            <li>action: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>user_roles</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>user_id: INT REFERENCES users</li>
                            <li>role_id: INT REFERENCES roles</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>granted_by: INT REFERENCES users</li>
                            <li>granted_at: TIMESTAMP</li>
                            <li>expires_at: TIMESTAMP</li>
                            <li>is_active: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>role_permissions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>role_id: INT REFERENCES roles</li>
                            <li>permission_id: INT REFERENCES permissions</li>
                            <li>conditions: JSONB</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Company & Relationship System</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>company_types</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>type_code: VARCHAR UNIQUE</li>
                            <li>type_name: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>required_fields: JSONB</li>
                            <li>allowed_features: JSONB</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>companies</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>company_type_id: INT REFERENCES company_types</li>
                            <li>name: VARCHAR</li>
                            <li>trading_name: VARCHAR</li>
                            <li>abn: VARCHAR</li>
                            <li>acn: VARCHAR</li>
                            <li>contact_info: JSONB</li>
                            <li>banking_info: JSONB</li>
                            <li>extended_data: JSONB</li>
                            <li>default_commission_model_id: INT</li>
                            <li>default_fee_model_id: INT</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>user_companies</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>role_in_company: VARCHAR</li>
                            <li>broker_code: VARCHAR UNIQUE</li>
                            <li>commission_split_percentage: DECIMAL</li>
                            <li>position_title: VARCHAR</li>
                            <li>department: VARCHAR</li>
                            <li>start_date: DATE</li>
                            <li>end_date: DATE</li>
                            <li>is_primary: BOOLEAN</li>
                            <li>status: VARCHAR</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>broker_relationships</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>parent_user_id: INT REFERENCES users</li>
                            <li>child_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>relationship_type: VARCHAR</li>
                            <li>parent_split_percentage: DECIMAL</li>
                            <li>child_split_percentage: DECIMAL</li>
                            <li>effective_from: DATE</li>
                            <li>effective_to: DATE</li>
                            <li>status: VARCHAR</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Loan & Settlement System</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>loans</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_number: VARCHAR UNIQUE</li>
                            <li>broker_user_id: INT REFERENCES users</li>
                            <li>sub_broker_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>client_name: VARCHAR</li>
                            <li>client_info: JSONB</li>
                            <li>lender_company_id: INT REFERENCES companies</li>
                            <li>loan_product: VARCHAR</li>
                            <li>loan_amount: DECIMAL</li>
                            <li>interest_rate: DECIMAL</li>
                            <li>loan_term_months: INT</li>
                            <li>loan_purpose: VARCHAR</li>
                            <li>application_date: DATE</li>
                            <li>approval_date: DATE</li>
                            <li>settlement_date: DATE</li>
                            <li>discharge_date: DATE</li>
                            <li>status: VARCHAR</li>
                            <li>source: VARCHAR</li>
                            <li>notes: TEXT</li>
                            <li>created_at: TIMESTAMP</li>
                            <li>updated_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>settlements</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>settlement_number: VARCHAR UNIQUE</li>
                            <li>broker_user_id: INT REFERENCES users</li>
                            <li>sub_broker_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>settlement_amount: DECIMAL</li>
                            <li>settlement_date: DATE</li>
                            <li>commission_model_id: INT REFERENCES commission_models</li>
                            <li>applied_upfront_rate: DECIMAL</li>
                            <li>applied_trail_rate: DECIMAL</li>
                            <li>gross_upfront: DECIMAL</li>
                            <li>gross_trail: DECIMAL</li>
                            <li>fees_applied: JSONB</li>
                            <li>total_fees: DECIMAL</li>
                            <li>net_upfront: DECIMAL</li>
                            <li>net_trail: DECIMAL</li>
                            <li>status: VARCHAR</li>
                            <li>processed_at: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Commission System</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>commission_models</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>name: VARCHAR</li>
                            <li>code: VARCHAR UNIQUE</li>
                            <li>upfront_percentage: DECIMAL</li>
                            <li>trail_percentage: DECIMAL</li>
                            <li>model_type: VARCHAR</li>
                            <li>tier_config: JSONB</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>effective_from: DATE</li>
                            <li>effective_to: DATE</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>upfront_commissions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>settlement_id: INT REFERENCES settlements</li>
                            <li>file_upload_id: INT REFERENCES file_uploads</li>
                            <li>broker_user_id: INT REFERENCES users</li>
                            <li>sub_broker_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>loan_number: VARCHAR</li>
                            <li>client_name: VARCHAR</li>
                            <li>gross_commission: DECIMAL</li>
                            <li>fees: JSONB</li>
                            <li>total_deductions: DECIMAL</li>
                            <li>net_commission: DECIMAL</li>
                            <li>gst_amount: DECIMAL</li>
                            <li>parent_broker_amount: DECIMAL</li>
                            <li>child_broker_amount: DECIMAL</li>
                            <li>commission_date: DATE</li>
                            <li>status: VARCHAR</li>
                            <li>payment_date: DATE</li>
                            <li>payment_reference: VARCHAR</li>
                            <li>payment_method: VARCHAR</li>
                            <li>approved_by: INT REFERENCES users</li>
                            <li>approved_at: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Kanban & Workflow System (NEW)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>workflow_stages</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>name: VARCHAR</li>
                            <li>stage_order: INT</li>
                            <li>color: VARCHAR</li>
                            <li>auto_actions: JSONB</li>
                            <li>sla_hours: INT</li>
                            <li>is_active: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>loan_tasks</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>assigned_to: INT REFERENCES users</li>
                            <li>task_type: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>due_date: TIMESTAMP</li>
                            <li>status: VARCHAR</li>
                            <li>priority: INT</li>
                        </ul>
                    </div>
                </div>

                <h3>Client Portal System (NEW)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>client_accounts</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>user_id: INT REFERENCES users</li>
                            <li>broker_id: INT REFERENCES users</li>
                            <li>portal_access: BOOLEAN</li>
                            <li>verification_status: VARCHAR</li>
                            <li>preferences: JSONB</li>
                            <li>last_login: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>document_requests</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>client_id: INT REFERENCES users</li>
                            <li>document_type: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>status: VARCHAR</li>
                            <li>due_date: DATE</li>
                            <li>uploaded_file_id: INT</li>
                        </ul>
                    </div>
                </div>

                <h3>AI/ML & Risk Assessment (NEW)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>risk_assessments</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>risk_score: DECIMAL</li>
                            <li>risk_factors: JSONB</li>
                            <li>model_version: VARCHAR</li>
                            <li>recommendations: TEXT</li>
                            <li>assessed_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>fact_finds</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>template_id: INT</li>
                            <li>generated_content: JSONB</li>
                            <li>ai_confidence: DECIMAL</li>
                            <li>manual_edits: JSONB</li>
                            <li>finalized_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Referral System (NEW)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>referral_partnerships</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>referrer_id: INT REFERENCES users</li>
                            <li>referee_id: INT REFERENCES users</li>
                            <li>partnership_type: VARCHAR</li>
                            <li>commission_split: JSONB</li>
                            <li>terms: TEXT</li>
                            <li>status: VARCHAR</li>
                            <li>valid_from: DATE</li>
                            <li>valid_to: DATE</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>referral_transactions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>partnership_id: INT</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>referral_fee: DECIMAL</li>
                            <li>status: VARCHAR</li>
                            <li>paid_date: DATE</li>
                        </ul>
                    </div>
                </div>

                <h3>Client Information Collection System (NEW)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>clients</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>broker_id: INT REFERENCES users</li>
                            <li>first_name: VARCHAR</li>
                            <li>last_name: VARCHAR</li>
                            <li>email: VARCHAR</li>
                            <li>phone: VARCHAR</li>
                            <li>date_of_birth: DATE</li>
                            <li>marital_status: VARCHAR</li>
                            <li>number_of_dependents: INT</li>
                            <li>employment_status: VARCHAR</li>
                            <li>current_stage: VARCHAR</li>
                            <li>personal_info: JSONB</li>
                            <li>preferences: JSONB</li>
                            <li>portal_access_token: VARCHAR</li>
                            <li>portal_last_accessed: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                            <li>updated_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_income</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>income_type: VARCHAR</li>
                            <li>employer_name: VARCHAR</li>
                            <li>annual_salary: DECIMAL</li>
                            <li>monthly_salary: DECIMAL</li>
                            <li>bonus_income: DECIMAL</li>
                            <li>overtime_income: DECIMAL</li>
                            <li>other_income: DECIMAL</li>
                            <li>employment_start_date: DATE</li>
                            <li>payslip_documents: JSONB</li>
                            <li>ai_extracted_data: JSONB</li>
                            <li>ai_confidence_score: DECIMAL</li>
                            <li>manual_verification: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_assets</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>asset_type: VARCHAR</li>
                            <li>asset_description: VARCHAR</li>
                            <li>estimated_value: DECIMAL</li>
                            <li>ownership_percentage: DECIMAL</li>
                            <li>property_address: VARCHAR</li>
                            <li>vehicle_details: JSONB</li>
                            <li>bank_account_details: JSONB</li>
                            <li>investment_details: JSONB</li>
                            <li>supporting_documents: JSONB</li>
                            <li>ai_extracted_value: DECIMAL</li>
                            <li>ai_confidence_score: DECIMAL</li>
                            <li>valuation_source: VARCHAR</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_liabilities</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>liability_type: VARCHAR</li>
                            <li>lender_name: VARCHAR</li>
                            <li>current_balance: DECIMAL</li>
                            <li>monthly_payment: DECIMAL</li>
                            <li>interest_rate: DECIMAL</li>
                            <li>loan_term_remaining: INT</li>
                            <li>credit_limit: DECIMAL</li>
                            <li>account_number: VARCHAR</li>
                            <li>liability_details: JSONB</li>
                            <li>ai_extracted_data: JSONB</li>
                            <li>ai_confidence_score: DECIMAL</li>
                            <li>supporting_documents: JSONB</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Document Processing & AI System (NEW)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>uploaded_documents</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>document_type: VARCHAR</li>
                            <li>document_category: VARCHAR</li>
                            <li>original_filename: VARCHAR</li>
                            <li>s3_file_path: VARCHAR</li>
                            <li>file_size: BIGINT</li>
                            <li>mime_type: VARCHAR</li>
                            <li>ai_processing_status: VARCHAR</li>
                            <li>ai_processing_started_at: TIMESTAMP</li>
                            <li>ai_processing_completed_at: TIMESTAMP</li>
                            <li>ai_extracted_text: TEXT</li>
                            <li>ai_structured_data: JSONB</li>
                            <li>ai_confidence_scores: JSONB</li>
                            <li>manual_review_required: BOOLEAN</li>
                            <li>manual_review_completed: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>ai_processing_logs</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>document_id: INT REFERENCES uploaded_documents</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>processing_type: VARCHAR</li>
                            <li>ai_model_version: VARCHAR</li>
                            <li>processing_started_at: TIMESTAMP</li>
                            <li>processing_completed_at: TIMESTAMP</li>
                            <li>extraction_results: JSONB</li>
                            <li>confidence_metrics: JSONB</li>
                            <li>errors_encountered: JSONB</li>
                            <li>processing_duration_ms: INT</li>
                            <li>success: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>factfind_templates</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>template_name: VARCHAR</li>
                            <li>template_version: VARCHAR</li>
                            <li>template_structure: JSONB</li>
                            <li>field_mappings: JSONB</li>
                            <li>validation_rules: JSONB</li>
                            <li>compliance_requirements: JSONB</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_by: INT REFERENCES users</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_factfinds</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>template_id: INT REFERENCES factfind_templates</li>
                            <li>ai_generated_data: JSONB</li>
                            <li>client_completed_data: JSONB</li>
                            <li>broker_reviewed_data: JSONB</li>
                            <li>final_factfind: JSONB</li>
                            <li>completion_percentage: DECIMAL</li>
                            <li>ai_confidence_overall: DECIMAL</li>
                            <li>requires_manual_review: BOOLEAN</li>
                            <li>broker_approved: BOOLEAN</li>
                            <li>client_signed_off: BOOLEAN</li>
                            <li>generated_at: TIMESTAMP</li>
                            <li>finalized_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Third-Party Integration System (NEW)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>quickli_submissions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>factfind_id: INT REFERENCES client_factfinds</li>
                            <li>submission_data: JSONB</li>
                            <li>quickli_submission_id: VARCHAR</li>
                            <li>submitted_at: TIMESTAMP</li>
                            <li>response_received_at: TIMESTAMP</li>
                            <li>lender_recommendations: JSONB</li>
                            <li>rate_comparisons: JSONB</li>
                            <li>best_recommendations: JSONB</li>
                            <li>broker_selected_products: JSONB</li>
                            <li>client_approved_products: JSONB</li>
                            <li>status: VARCHAR</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>applyonline_applications</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>quickli_submission_id: INT REFERENCES quickli_submissions</li>
                            <li>selected_lender: VARCHAR</li>
                            <li>selected_product: JSONB</li>
                            <li>application_package: JSONB</li>
                            <li>applyonline_app_id: VARCHAR</li>
                            <li>submitted_at: TIMESTAMP</li>
                            <li>current_status: VARCHAR</li>
                            <li>lender_response: JSONB</li>
                            <li>conditional_approval: JSONB</li>
                            <li>final_approval: JSONB</li>
                            <li>settlement_date: DATE</li>
                            <li>commission_triggered: BOOLEAN</li>
                            <li>commission_processed_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>integration_logs</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>integration_type: VARCHAR</li>
                            <li>external_system: VARCHAR</li>
                            <li>request_data: JSONB</li>
                            <li>response_data: JSONB</li>
                            <li>request_timestamp: TIMESTAMP</li>
                            <li>response_timestamp: TIMESTAMP</li>
                            <li>http_status_code: INT</li>
                            <li>success: BOOLEAN</li>
                            <li>error_message: TEXT</li>
                            <li>retry_count: INT</li>
                        </ul>
                    </div>
                </div>

                <h3>Enhanced Kanban Workflow System (UPDATED)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>kanban_stages</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>stage_name: VARCHAR</li>
                            <li>stage_order: INT</li>
                            <li>stage_color: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>required_actions: JSONB</li>
                            <li>auto_progression_rules: JSONB</li>
                            <li>sla_hours: INT</li>
                            <li>notification_triggers: JSONB</li>
                            <li>is_active: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_stage_history</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>from_stage: VARCHAR</li>
                            <li>to_stage: VARCHAR</li>
                            <li>moved_by: INT REFERENCES users</li>
                            <li>moved_at: TIMESTAMP</li>
                            <li>duration_in_previous_stage_hours: INT</li>
                            <li>completion_percentage: DECIMAL</li>
                            <li>notes: TEXT</li>
                            <li>automated_move: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_tasks</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>task_type: VARCHAR</li>
                            <li>task_description: TEXT</li>
                            <li>assigned_to: INT REFERENCES users</li>
                            <li>priority: INT</li>
                            <li>due_date: TIMESTAMP</li>
                            <li>status: VARCHAR</li>
                            <li>completion_notes: TEXT</li>
                            <li>completed_by: INT REFERENCES users</li>
                            <li>completed_at: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>

        <!-- Feature Design Tab -->
        <div id="feature-design" class="tab-content active">
            <div class="alert alert-info">
                <strong>üìÖ Last Updated:</strong> August 2025<br>
                <strong>üéØ Purpose:</strong> Complete system redesign from microservices to monolithic architecture with new features<br>
                <strong>üìä Status:</strong> Requirement Analysis Phase
            </div>

            <h2>üìå Executive Summary</h2>
            <div class="section">
                <p><strong>HarbourX</strong> is a comprehensive client-centric financial services platform that revolutionizes how brokers collect, process, and manage client information for loan applications. The system combines intelligent document processing, AI-powered data extraction, and seamless integration with industry-leading platforms like Quickli and ApplyOnline to streamline the entire loan origination process.</p>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h3>üéØ Key Objectives</h3>
                        <ul>
                            <li>Streamline client information collection</li>
                            <li>Automate document processing with AI</li>
                            <li>Integrate with Quickli (40+ lenders)</li>
                            <li>Seamless ApplyOnline integration</li>
                            <li>Reduce manual data entry by 90%</li>
                            <li>Enhance broker productivity</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3>‚ö° Core Workflow</h3>
                        <ul>
                            <li>Client-centric Kanban board</li>
                            <li>AI document analysis & extraction</li>
                            <li>Auto-generated Factfind templates</li>
                            <li>Client portal for missing info</li>
                            <li>Quickli integration for loan comparison</li>
                            <li>ApplyOnline application submission</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3>ü§ñ AI-Powered Features</h3>
                        <ul>
                            <li>Payslip income extraction</li>
                            <li>Asset valuation from documents</li>
                            <li>Liability assessment</li>
                            <li>OCR document processing</li>
                            <li>Auto-fill client information</li>
                            <li>Compliance validation</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h2>üèóÔ∏è System Architecture</h2>
            <div class="section">
                <div class="mermaid">
flowchart TB
    subgraph "Client Layer"
        WEB[Web Browser]
        MOB[Mobile Browser]
        API[External APIs]
    end
    
    subgraph "Application Layer"
        APP[HarbourX Monolith]
        
        subgraph "Core Modules"
            AUTH[Authentication]
            USER[User Management]
            LOAN[Loan Processing]
            COMM[Commissions]
            PORT[Client Portal]
        end
        
        subgraph "New Features"
            KAN[Kanban Board]
            REF[Referral System]
            AI[AI/ML Engine]
            DOC[Document Manager]
            SIGN[Digital Signatures]
        end
    end
    
    subgraph "External Services"
        QUICKLI[Quickli Platform]
        APPLYONLINE[ApplyOnline]
        LEND[Lender APIs]
        CREDIT[Credit Check]
        KYC[Identity Verification]
        EMAIL[Email Service]
        SMS[SMS Gateway]
    end
    
    subgraph "Data Layer"
        PG[(PostgreSQL)]
        REDIS[(Redis Cache)]
        S3[Object Storage]
    end
    
    WEB --> APP
    MOB --> APP
    API --> APP
    
    APP --> PG
    APP --> REDIS
    APP --> S3
    
    APP --> QUICKLI
    APP --> APPLYONLINE
    APP --> LEND
    APP --> CREDIT
    APP --> KYC
    APP --> EMAIL
    APP --> SMS
    
    style APP fill:#667eea,color:#fff
    style PG fill:#336791,color:#fff
    style REDIS fill:#dc382d,color:#fff
                </div>
            </div>

            <h2>üë§ User Journey Diagrams</h2>
            <div class="section">
                
                <h3>üéØ Streamlined Broker Journey - Optimized Process</h3>
                <div class="diagram-container">
                    <div class="mermaid">
graph LR
    A[New Client<br/>Contact] --> B[Create Client Card<br/>& Send Portal Link]
    B --> C[Client Portal<br/>Document Upload]
    C --> D[AI Auto-Processing<br/>& Factfind Generation]
    D --> E[Quickli Analysis<br/>40+ Lenders]
    E --> F[Present & Approve<br/>Best Options]
    F --> G[ApplyOnline<br/>Submission]
    G --> H[Settlement &<br/>Commission]

    style A fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    style D fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style E fill:#e8f5e8,stroke:#4caf50,stroke-width:3px
    style G fill:#fff3e0,stroke:#ff9800,stroke-width:3px
    style H fill:#e8f6f3,stroke:#16a085,stroke-width:3px
                    </div>
                </div>

                <h3>üìä Simplified Client Kanban Flow</h3>
                <div class="diagram-container">
                    <div class="mermaid">
flowchart LR
    A[New Client] --> B[Document Upload<br/>& AI Processing]
    B --> C[Factfind Generation<br/>& Review]
    C --> D[Quickli Analysis<br/>& Approval]
    D --> E[Application<br/>Submission]
    E --> F[Settlement]

    style A fill:#ffebee,stroke:#f44336,stroke-width:3px
    style B fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    style C fill:#e1f5fe,stroke:#0288d1,stroke-width:3px
    style D fill:#e8f5e8,stroke:#4caf50,stroke-width:3px
    style E fill:#fff3e0,stroke:#ff9800,stroke-width:3px
    style F fill:#e8f6f3,stroke:#16a085,stroke-width:3px
                    </div>
                </div>

                <h3>ü§ñ AI Document Processing Workflow</h3>
                <div class="diagram-container">
                    <div class="mermaid">
flowchart TD
    START[Client Uploads Documents] --> UPLOAD[Document Storage<br/>in S3]
    UPLOAD --> DETECT[Document Type<br/>Detection]
    
    DETECT --> PAYSLIP{Payslip?}
    DETECT --> ASSET{Asset Doc?}
    DETECT --> LIABILITY{Liability?}
    
    PAYSLIP -->|Yes| INCOME[Extract Income Data<br/>‚Ä¢ Salary<br/>‚Ä¢ Bonuses<br/>‚Ä¢ Deductions]
    ASSET -->|Yes| ASSETS[Extract Asset Info<br/>‚Ä¢ Property Value<br/>‚Ä¢ Vehicle Worth<br/>‚Ä¢ Bank Balance]
    LIABILITY -->|Yes| LIAB[Extract Liability Data<br/>‚Ä¢ Loan Balance<br/>‚Ä¢ Monthly Payment<br/>‚Ä¢ Interest Rate]
    
    INCOME --> VALIDATE[Data Validation<br/>& Confidence Scoring]
    ASSETS --> VALIDATE
    LIAB --> VALIDATE
    
    VALIDATE --> FACTFIND[Auto-populate<br/>Factfind Template]
    FACTFIND --> REVIEW[Broker Review<br/>& Approval]
    
    style START fill:#e3f2fd,stroke:#1976d2
    style DETECT fill:#f3e5f5,stroke:#7b1fa2
    style VALIDATE fill:#fff3e0,stroke:#ff9800
    style FACTFIND fill:#e8f6f3,stroke:#16a085
                    </div>
                </div>

                <h3>üîÑ Third-Party Integration Flow</h3>
                <div class="diagram-container">
                    <div class="mermaid">
sequenceDiagram
    participant C as Client
    participant H as HarbourX
    participant Q as Quickli
    participant A as ApplyOnline
    participant L as Lender
    
    C->>H: Complete Information
    H->>H: Generate Factfind
    H->>Q: Send Client Data
    Q->>Q: Analyze 40+ Lenders
    Q->>H: Return Recommendations
    H->>C: Present Options
    C->>H: Approve Selection
    H->>A: Submit Application
    A->>L: Forward to Lender
    L->>A: Application Status
    A->>H: Status Updates
    H->>C: Progress Notification
    L->>A: Final Approval
    A->>H: Settlement Trigger
    H->>H: Process Commission
                    </div>
                </div>

                <h3>üë• Client Portal User Experience</h3>
                <div class="diagram-container">
                    <div class="mermaid">
journey
    title Client Portal Experience
    section Registration
        Receive Portal Link: 5: Client
        Create Account: 4: Client
        Verify Identity: 4: Client
    section Information Collection
        View Dashboard: 5: Client
        Upload Payslips: 4: Client
        Upload Asset Docs: 4: Client
        Upload Liability Docs: 4: Client
        Get AI Feedback: 5: Client
    section Gap Completion
        Review Missing Info: 4: Client
        Fill Personal Details: 3: Client
        Add Marital Status: 3: Client
        Submit Completion: 4: Client
    section Review & Approval
        View Loan Options: 5: Client
        Compare Rates: 5: Client
        Select Preferred: 4: Client
        Approve Application: 5: Client
    section Tracking
        Monitor Progress: 5: Client
        Receive Updates: 5: Client
        Final Notification: 5: Client
                    </div>
                </div>

            </div>

            <div class="diagram-container">
                <h2>üöÄ System Features & Capabilities</h2>
                
                <div class="domain-grid">
                    <div class="domain-card" style="border-top: 4px solid #3498db;">
                        <h3>1. Client-Centric Kanban System</h3>
                        <p><strong>Core entity: Every client of current broker</strong></p>
                        <ul>
                            <li>Client cards represent individuals, not loans</li>
                            <li>11-stage workflow from new client to settlement</li>
                            <li>Visual progress tracking for information collection</li>
                            <li>Drag-drop client management</li>
                            <li>Real-time status updates</li>
                            <li>Automated stage progression based on completed tasks</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #e67e22;">
                        <h3>2. AI-Powered Document Processing</h3>
                        <p><strong>Intelligent automation for all uploaded files:</strong></p>
                        <ul>
                            <li><strong>Payslip Analysis:</strong> Extract salary, bonuses, overtime, deductions</li>
                            <li><strong>Asset Recognition:</strong> Property valuations, vehicle worth, savings accounts</li>
                            <li><strong>Liability Assessment:</strong> Existing loans, credit card limits, commitments</li>
                            <li><strong>OCR Processing:</strong> Convert all document types to structured data</li>
                            <li><strong>Data Validation:</strong> Cross-reference and verify extracted information</li>
                            <li><strong>Auto-fill Factfind:</strong> Populate comprehensive client profile</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #2ecc71;">
                        <h3>3. Enhanced Client Portal</h3>
                        <p><strong>Streamlined information collection interface:</strong></p>
                        <ul>
                            <li>Personal info collection (basic details)</li>
                            <li>Income document upload (payslips, tax returns)</li>
                            <li>Asset documentation (property, vehicles, savings)</li>
                            <li>Liability statements (existing loans, credit cards)</li>
                            <li>Gap completion for non-extractable data (marital status, preferences)</li>
                            <li>Real-time AI processing feedback</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #4caf50;">
                        <h3>4. Quickli Platform Integration</h3>
                        <p><strong>40+ lender calculator and comparison engine:</strong></p>
                        <ul>
                            <li>Automated Factfind data transfer</li>
                            <li>Real-time rate and product comparison</li>
                            <li>Best-fit loan recommendations</li>
                            <li>Comprehensive lender analysis</li>
                            <li>Cost comparison and fee analysis</li>
                            <li>Client-friendly recommendation reports</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #ff9800;">
                        <h3>5. ApplyOnline Integration</h3>
                        <p><strong>Seamless application submission platform:</strong></p>
                        <ul>
                            <li>Direct handoff from Quickli selections</li>
                            <li>Automated application package compilation</li>
                            <li>Lender-specific submission formats</li>
                            <li>Real-time application status tracking</li>
                            <li>Communication hub for lender queries</li>
                            <li>Settlement coordination and commission triggers</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #9c27b0;">
                        <h3>6. Automated Factfind Generation</h3>
                        <p><strong>Complete client profile compilation:</strong></p>
                        <ul>
                            <li>Template-based information structuring</li>
                            <li>AI-extracted data population</li>
                            <li>Client-completed gap information</li>
                            <li>Regulatory compliance validation</li>
                            <li>Broker review and customization</li>
                            <li>Export to multiple formats (Quickli, ApplyOnline, PDF)</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #f39c12;">
                        <h3>7. Commission & Settlement System</h3>
                        <p><strong>End-to-end commission processing:</strong></p>
                        <ul>
                            <li>Settlement-triggered commission calculation</li>
                            <li>Automated RCTI generation</li>
                            <li>Referral commission splits</li>
                            <li>Multi-tier broker hierarchies</li>
                            <li>Payment tracking and reconciliation</li>
                            <li>Commission reporting and analytics</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #607d8b;">
                        <h3>8. Data Intelligence & Analytics</h3>
                        <p><strong>Business intelligence and insights:</strong></p>
                        <ul>
                            <li>Client conversion funnel analysis</li>
                            <li>AI processing accuracy metrics</li>
                            <li>Quickli recommendation success rates</li>
                            <li>ApplyOnline application outcomes</li>
                            <li>Broker performance dashboards</li>
                            <li>Predictive analytics for loan success</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="diagram-container">
                <h2>Why This Architecture?</h2>
                
                <div class="explanation-box" style="background: #fadbd8; border-left: 4px solid #c62828;">
                    <h3>‚ö†Ô∏è Current System Limitations</h3>
                    <p><strong>Critical issues with the existing microservices architecture:</strong></p>
                    
                    <h4>1. Data Duplication & Inconsistency</h4>
                    <ul>
                        <li>Same broker data exists in 5+ different databases</li>
                        <li>RCTI data scattered across multiple services</li>
                        <li>Data synchronization failures causing inconsistencies</li>
                        <li>No single source of truth for critical business data</li>
                    </ul>
                    
                    <h4>2. Over-Engineered Code</h4>
                    <ul>
                        <li>Most services are AI-generated with excessive complexity</li>
                        <li>Simple CRUD operations have 1000+ lines of boilerplate</li>
                        <li>Difficult to understand and maintain</li>
                        <li>Bug fixes require changes in multiple services</li>
                    </ul>
                    
                    <h4>3. Infrastructure Overkill</h4>
                    <ul>
                        <li><strong>K8s is massively over-provisioned:</strong> CPU usage &lt;20%, Network &lt;20%, DB &lt;20%</li>
                        <li>Managing CSV files in pods is fragile and ugly</li>
                        <li>PostgreSQL running in pods without proper backup</li>
                        <li>Complex orchestration for simple workflows</li>
                    </ul>
                    
                    <h4>4. No Monitoring or Observability</h4>
                    <ul>
                        <li>No centralized monitoring dashboard</li>
                        <li>Cannot track system health or performance</li>
                        <li>Debugging requires checking 11 different log streams</li>
                        <li>No alerting for failures or issues</li>
                    </ul>
                </div>
                
                <div class="explanation-box" style="background: #e8f6f3; border-left: 4px solid #16a085;">
                    <h3>‚úÖ Solution: Monolithic Architecture</h3>
                    <p><strong>How the new architecture addresses these issues:</strong></p>
                    
                    <h4>1. Data Unification</h4>
                    <ul>
                        <li><strong>Before:</strong> 11 databases with duplicated, inconsistent data</li>
                        <li><strong>After:</strong> Single PostgreSQL database with normalized schema</li>
                        <li><strong>Result:</strong> Zero data duplication, 100% consistency</li>
                    </ul>
                    
                    <h4>2. Simplified Codebase</h4>
                    <ul>
                        <li><strong>Before:</strong> Over-complicated AI-generated services</li>
                        <li><strong>After:</strong> Clean, maintainable monolithic codebase</li>
                        <li><strong>Result:</strong> 60% less code, easier to understand and debug</li>
                    </ul>
                    
                    <h4>3. Right-Sized Infrastructure</h4>
                    <ul>
                        <li><strong>Before:</strong> K8s with &lt;20% resource utilization</li>
                        <li><strong>After:</strong> Simple deployment on 2-3 VMs or containers</li>
                        <li><strong>Result:</strong> 80% infrastructure cost reduction</li>
                    </ul>
                    
                    <h4>4. Built-in Monitoring</h4>
                    <ul>
                        <li><strong>Before:</strong> No monitoring or observability</li>
                        <li><strong>After:</strong> Grafana + Prometheus from day one</li>
                        <li><strong>Result:</strong> Full visibility into system health and performance</li>
                    </ul>
                    
                    <h4>5. Additional Benefits</h4>
                    <ul>
                        <li>ACID transactions across all operations</li>
                        <li>No network latency between services</li>
                        <li>Simpler deployment and maintenance</li>
                        <li>Faster development of new features</li>
                        <li>Easy local development environment</li>
                    </ul>
                </div>
            </div>

            <div class="diagram-container">
                <h2>Complete System Architecture</h2>
                <div class="mermaid">
flowchart TB
    subgraph "Layer 1: User Interface"
        direction LR
        Portal[fa:fa-user-circle Client Portal<br/>For Loan Applicants]
        Kanban[fa:fa-columns Kanban Board<br/>For Brokers]
        Dashboard[fa:fa-chart-line Dashboard<br/>For Brokers]
    end
    
    subgraph "Layer 2: Core Features"
        direction LR
        Users[fa:fa-users Users]
        Companies[fa:fa-building Companies]
        Referral[fa:fa-handshake Referrals]
        AI[fa:fa-robot AI Engine<br/>‚Ä¢ Loan Summary<br/>‚Ä¢ Compliance Gen<br/>‚Ä¢ Best Interest Duty<br/>‚Ä¢ Factfind Extract<br/>‚Ä¢ Financial Analysis<br/>‚Ä¢ Pay Slip Analysis]
    end
    
    subgraph "Layer 3: Business Logic"
        direction LR
        Loans[fa:fa-file-invoice Loans]
        Settlements[fa:fa-check Settlements]
        Files[fa:fa-upload File Processing<br/>‚Ä¢ DOCX, PDF, Excel, CSV<br/>‚Ä¢ RCTI from Lenders<br/>‚Ä¢ Multi-format Parsing<br/>‚Ä¢ Data Extraction]
    end
    
    subgraph "Layer 4: Financial Processing"
        direction LR
        Upfront[fa:fa-dollar Upfront Comm.]
        Trail[fa:fa-sync Trail Comm.]
        RCTI[fa:fa-receipt RCTI]
    end
    
    subgraph "Layer 5: Data Storage"
        direction LR
        PG[(PostgreSQL)]
        Mongo[(MongoDB)]
        S3[fa:fa-cloud S3 Storage]
    end
    
    %% Simplified connections between layers
    Portal --> Users
    Kanban --> Loans
    Dashboard --> Loans
    
    Users --> Loans
    Companies --> Loans
    Referral --> Loans
    AI --> Loans
    
    Loans --> Settlements
    Files --> Settlements
    
    Settlements --> Upfront
    Settlements --> Trail
    
    Upfront --> RCTI
    Trail --> RCTI
    
    RCTI --> PG
    Loans --> PG
    Files --> S3
    AI --> Mongo
    
    %% Styles
    classDef uiClass fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef featureClass fill:#e8f8f5,stroke:#00897b,stroke-width:2px
    classDef businessClass fill:#fef9e7,stroke:#f9a825,stroke-width:2px
    classDef financeClass fill:#fdebd0,stroke:#ef6c00,stroke-width:2px
    classDef dataClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    
    class Portal,Kanban,Dashboard uiClass
    class Users,Companies,Referral,AI featureClass
    class Loans,Settlements,Files businessClass
    class Upfront,Trail,RCTI financeClass
    class PG,Mongo,S3 dataClass
                </div>
            </div>

            <div class="summary-box">
                <h3>üìã Implementation Roadmap & Tasks</h3>
                
                <div class="domain-grid">
                    <div class="domain-card" style="border-top: 4px solid #e74c3c;">
                        <h3>Phase 1: UI/UX Design</h3>
                        <h4>Design System & User Experience</h4>
                        <ul>
                            <li>‚¨ú User research & personas</li>
                            <li>‚¨ú Information architecture</li>
                            <li>‚¨ú Wireframes for all modules</li>
                            <li>‚¨ú Design system & component library</li>
                            <li>‚¨ú Kanban board UI design</li>
                            <li>‚¨ú Client portal interface</li>
                            <li>‚¨ú Mobile responsive design</li>
                            <li>‚¨ú Usability testing</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #3498db;">
                        <h3>Phase 2: Database Architecture</h3>
                        <h4>Data Layer Foundation</h4>
                        <ul>
                            <li>‚úÖ Design unified database schema</li>
                            <li>‚úÖ Define all entity relationships</li>
                            <li>‚¨ú Create migration scripts from microservices</li>
                            <li>‚¨ú Set up database indexes and constraints</li>
                            <li>‚¨ú Implement audit logging structure</li>
                            <li>‚¨ú Data deduplication strategy</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #2ecc71;">
                        <h3>Phase 4: Core Migration</h3>
                        <h4>Monolith Development</h4>
                        <ul>
                            <li>‚¨ú User & authentication system</li>
                            <li>‚¨ú Company & role management</li>
                            <li>‚¨ú Loan processing pipeline</li>
                            <li>‚¨ú Commission calculations</li>
                            <li>‚¨ú RCTI generation</li>
                            <li>‚¨ú Data migration & cleanup</li>
                            <li>‚¨ú Remove K8s complexity</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #e67e22;">
                        <h3>Phase 6: New Features</h3>
                        <h4>Feature Implementation</h4>
                        <ul>
                            <li>‚¨ú Referral system with splits</li>
                            <li>‚¨ú Kanban loan management</li>
                            <li>‚¨ú Client portal & uploads</li>
                            <li>‚¨ú Digital signatures</li>
                            <li>‚¨ú <strong>AI Loan Summary</strong> - Auto-generate comprehensive loan summaries</li>
                            <li>‚¨ú <strong>Compliance File Generation</strong> - Automated regulatory documents</li>
                            <li>‚¨ú <strong>Best Interest Duty</strong> - Compliance checking & recommendations</li>
                            <li>‚¨ú <strong>Factfind Extraction</strong> - Extract client data from documents</li>
                            <li>‚¨ú <strong>Financial Report Analysis</strong> - Parse bank statements automatically</li>
                            <li>‚¨ú <strong>Pay Slip Analysis</strong> - Income verification & extraction</li>
                            <li>‚¨ú Advanced file processing (DOCX, PDF, Excel, CSV, RCTI)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="section" style="text-align: center; margin-top: 50px; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px;">
            <h2 style="color: white; border: none;">üö¢ HarbourX - Navigating Financial Success</h2>
            <p style="font-size: 1.2em; margin: 20px 0;">Complete system design combining database architecture and feature specifications</p>
            <p style="opacity: 0.9;">¬© 2024 HarbourX - Combined Design Document v1.0</p>
        </div>
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                padding: 20,
                nodeSpacing: 50,
                rankSpacing: 80
            },
            er: {
                layoutDirection: 'TB',
                minEntityWidth: 100,
                minEntityHeight: 75,
                entityPadding: 15,
                stroke: '#333',
                fill: '#fff'
            },
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#5a67d8',
                lineColor: '#333',
                sectionBkgColor: '#f7fafc',
                altSectionBkgColor: '#edf2f7',
                gridColor: '#e2e8f0',
                cScale0: '#667eea',
                cScale1: '#764ba2',
                cScale2: '#3498db'
            }
        });
    </script>
</body>
</html>