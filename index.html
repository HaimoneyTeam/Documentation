<!DOCTYPE html>
<html>
<head>
    <title>HarbourX - 完整系统设计与架构</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            border-bottom: 3px solid #eee;
            margin-bottom: 30px;
            gap: 0;
        }
        .tab-button {
            background: #f8f9fa;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
            color: #6c757d;
        }
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .tab-button:hover:not(.active) {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* Header Section */
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }
        


        /* Common Styles */
        h1 {
            color: #2c3e50;
            text-align: center;
            font-size: 2.5em;
            padding-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            margin-bottom: 0;
            flex: 1;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 4px solid #667eea;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }
        .feature-card h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .database-table {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .database-table h4 {
            margin-top: 0;
            color: #495057;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        .field-list {
            list-style: none;
            padding: 0;
        }
        .field-list li {
            padding: 5px 0;
            border-bottom: 1px solid #f1f3f5;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        .tech-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }
        .timeline {
            position: relative;
            padding-left: 40px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #667eea;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -30px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }
        .status-complete {
            background: #d4edda;
            color: #155724;
        }
        .status-in-progress {
            background: #fff3cd;
            color: #856404;
        }
        .status-pending {
            background: #f8d7da;
            color: #721c24;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        .alert-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }
        .diagram-container {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .summary-box {
            background: #e8f6f3;
            border-left: 4px solid #16a085;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .domain-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .domain-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .user-domain {
            border-top: 4px solid #3498db;
        }
        .business-domain {
            border-top: 4px solid #27ae60;
        }
        .explanation-box {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            min-height: 500px;
            overflow-x: auto;
            overflow-y: hidden;
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
        }
        .mermaid.small {
            min-height: 300px;
            padding: 15px;
        }
        .mermaid svg {
            max-width: 100%;
            height: auto;
            min-width: 100%;
        }
        .mermaid a {
            color: #1976d2;
            text-decoration: underline;
            font-size: 10px;
        }
        
        /* Responsive improvements */
        @media (max-width: 1200px) {
            .mermaid {
                min-height: 450px;
                padding: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .mermaid {
                min-height: 350px;
                padding: 10px;
                overflow-x: scroll;
            }
            .mermaid svg {
                min-width: 320px;
                font-size: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .mermaid {
                min-height: 300px;
                padding: 8px;
            }
            .mermaid svg {
                min-width: 280px;
                font-size: 10px;
            }
        }
        
        /* 新图表样式 */
        .architecture-overview {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .arch-layers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .arch-layer {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .arch-layer h4 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .arch-layer ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .arch-layer li {
            margin-bottom: 8px;
            color: #495057;
        }
        
        /* 流程步骤样式 */
        .journey-flow, .kanban-flow, .ai-processing-flow, .integration-flow {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .flow-step, .kanban-step, .ai-step, .integration-step {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            min-width: 150px;
            transition: transform 0.3s ease;
        }
        
        .flow-step:hover, .kanban-step:hover, .ai-step:hover, .integration-step:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }
        
        .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-weight: bold;
            font-size: 18px;
        }
        
        .step-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }
        
        .flow-arrow {
            font-size: 2em;
            color: #667eea;
            font-weight: bold;
        }
        
        .flow-step h4, .kanban-step h4, .ai-step h4, .integration-step h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .flow-step p, .kanban-step p, .ai-step p, .integration-step p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9em;
        }
        
        /* 集成流程详情 */
        .integration-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #28a745;
        }
        
        .integration-details h4 {
            color: #155724;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .integration-details ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .integration-details li {
            margin-bottom: 8px;
            color: #495057;
        }
        
        /* 客户门户体验 */
        .portal-experience {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .experience-phase {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .experience-phase h4 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        .phase-steps {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .exp-step {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .step-emoji {
            font-size: 1.2em;
        }
        
        .rating {
            margin-left: auto;
            color: #ffc107;
        }
        
        /* 系统架构层 */
        .system-architecture-layers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .arch-layer-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-top: 4px solid #667eea;
        }
        
        .arch-layer-card h3 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .layer-components {
            display: grid;
            gap: 15px;
        }
        
        .component {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid #28a745;
        }
        
        .component-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
        
        .component h4 {
            margin: 0 0 8px 0;
            color: #2c3e50;
            display: inline-block;
        }
        
        .component p {
            margin: 0 0 8px 0;
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .component ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .component li {
            margin-bottom: 5px;
            color: #495057;
            font-size: 0.9em;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .journey-flow, .kanban-flow, .ai-processing-flow, .integration-flow {
                flex-direction: column;
            }
            
            .flow-arrow {
                transform: rotate(90deg);
            }
            
            .arch-layers, .system-architecture-layers {
                grid-template-columns: 1fr;
            }
            
            .portal-experience {
                grid-template-columns: 1fr;
            }
        }
        
        /* Additional responsive improvements */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px;
                border-radius: 15px;
            }
            h1 {
                font-size: 2em;
            }
            .tabs {
                flex-direction: column;
                gap: 5px;
            }
            .tab-button {
                text-align: center;
                margin-right: 0;
                border-radius: 8px;
            }
            .feature-grid {
                grid-template-columns: 1fr;
            }
            .domain-grid {
                grid-template-columns: 1fr;
            }
            .section {
                padding: 15px;
            }
            .diagram-container {
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 1.8em;
                padding-bottom: 15px;
            }
            h2 {
                font-size: 1.4em;
            }
            h3 {
                font-size: 1.2em;
            }
            .section {
                padding: 12px;
                margin: 15px 0;
            }
            .feature-card, .domain-card {
                padding: 15px;
            }
            .tab-button {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1>🚢 HarbourX - 完整系统设计与架构</h1>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'feature-design')">🎯 功能设计</button>
            <button class="tab-button" onclick="openTab(event, 'database-design')">🗄️ 数据库设计</button>
        </div>

        <!-- Database Design Tab -->
        <div id="database-design" class="tab-content">
            
            <h2>💾 数据库架构 - 完整设计</h2>
            <div class="section">
                <h3>核心用户与身份系统</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>users</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>email: VARCHAR UNIQUE</li>
                            <li>username: VARCHAR UNIQUE</li>
                            <li>first_name: VARCHAR</li>
                            <li>last_name: VARCHAR</li>
                            <li>phone: VARCHAR</li>
                            <li>password_hash: VARCHAR</li>
                            <li>professional_info: JSONB</li>
                            <li>avatar_url: VARCHAR</li>
                            <li>preferences: JSONB</li>
                            <li>is_email_verified: BOOLEAN</li>
                            <li>is_active: BOOLEAN</li>
                            <li>last_login: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>roles</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>name: VARCHAR UNIQUE</li>
                            <li>description: TEXT</li>
                            <li>properties: JSONB</li>
                            <li>config: JSONB</li>
                            <li>parent_role_id: INT REFERENCES roles</li>
                            <li>is_system_role: BOOLEAN</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>permissions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>resource: VARCHAR</li>
                            <li>action: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>user_roles</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>user_id: INT REFERENCES users</li>
                            <li>role_id: INT REFERENCES roles</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>granted_by: INT REFERENCES users</li>
                            <li>granted_at: TIMESTAMP</li>
                            <li>expires_at: TIMESTAMP</li>
                            <li>is_active: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>role_permissions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>role_id: INT REFERENCES roles</li>
                            <li>permission_id: INT REFERENCES permissions</li>
                            <li>conditions: JSONB</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>公司与关系系统</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>company_types</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>type_code: VARCHAR UNIQUE</li>
                            <li>type_name: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>required_fields: JSONB</li>
                            <li>allowed_features: JSONB</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>companies</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>company_type_id: INT REFERENCES company_types</li>
                            <li>name: VARCHAR</li>
                            <li>trading_name: VARCHAR</li>
                            <li>abn: VARCHAR</li>
                            <li>acn: VARCHAR</li>
                            <li>contact_info: JSONB</li>
                            <li>banking_info: JSONB</li>
                            <li>extended_data: JSONB</li>
                            <li>default_commission_model_id: INT</li>
                            <li>default_fee_model_id: INT</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>user_companies</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>role_in_company: VARCHAR</li>
                            <li>broker_code: VARCHAR UNIQUE</li>
                            <li>commission_split_percentage: DECIMAL</li>
                            <li>position_title: VARCHAR</li>
                            <li>department: VARCHAR</li>
                            <li>start_date: DATE</li>
                            <li>end_date: DATE</li>
                            <li>is_primary: BOOLEAN</li>
                            <li>status: VARCHAR</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>broker_relationships</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>parent_user_id: INT REFERENCES users</li>
                            <li>child_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>relationship_type: VARCHAR</li>
                            <li>parent_split_percentage: DECIMAL</li>
                            <li>child_split_percentage: DECIMAL</li>
                            <li>effective_from: DATE</li>
                            <li>effective_to: DATE</li>
                            <li>status: VARCHAR</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>贷款与结算系统</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>loans</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_number: VARCHAR UNIQUE</li>
                            <li>broker_user_id: INT REFERENCES users</li>
                            <li>sub_broker_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>client_name: VARCHAR</li>
                            <li>client_info: JSONB</li>
                            <li>lender_company_id: INT REFERENCES companies</li>
                            <li>loan_product: VARCHAR</li>
                            <li>loan_amount: DECIMAL</li>
                            <li>interest_rate: DECIMAL</li>
                            <li>loan_term_months: INT</li>
                            <li>loan_purpose: VARCHAR</li>
                            <li>application_date: DATE</li>
                            <li>approval_date: DATE</li>
                            <li>settlement_date: DATE</li>
                            <li>discharge_date: DATE</li>
                            <li>status: VARCHAR</li>
                            <li>source: VARCHAR</li>
                            <li>notes: TEXT</li>
                            <li>created_at: TIMESTAMP</li>
                            <li>updated_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>settlements</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>settlement_number: VARCHAR UNIQUE</li>
                            <li>broker_user_id: INT REFERENCES users</li>
                            <li>sub_broker_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>settlement_amount: DECIMAL</li>
                            <li>settlement_date: DATE</li>
                            <li>commission_model_id: INT REFERENCES commission_models</li>
                            <li>applied_upfront_rate: DECIMAL</li>
                            <li>applied_trail_rate: DECIMAL</li>
                            <li>gross_upfront: DECIMAL</li>
                            <li>gross_trail: DECIMAL</li>
                            <li>fees_applied: JSONB</li>
                            <li>total_fees: DECIMAL</li>
                            <li>net_upfront: DECIMAL</li>
                            <li>net_trail: DECIMAL</li>
                            <li>status: VARCHAR</li>
                            <li>processed_at: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>佣金系统</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>commission_models</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>name: VARCHAR</li>
                            <li>code: VARCHAR UNIQUE</li>
                            <li>upfront_percentage: DECIMAL</li>
                            <li>trail_percentage: DECIMAL</li>
                            <li>model_type: VARCHAR</li>
                            <li>tier_config: JSONB</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>effective_from: DATE</li>
                            <li>effective_to: DATE</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>upfront_commissions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>settlement_id: INT REFERENCES settlements</li>
                            <li>file_upload_id: INT REFERENCES file_uploads</li>
                            <li>broker_user_id: INT REFERENCES users</li>
                            <li>sub_broker_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>loan_number: VARCHAR</li>
                            <li>client_name: VARCHAR</li>
                            <li>gross_commission: DECIMAL</li>
                            <li>fees: JSONB</li>
                            <li>total_deductions: DECIMAL</li>
                            <li>net_commission: DECIMAL</li>
                            <li>gst_amount: DECIMAL</li>
                            <li>parent_broker_amount: DECIMAL</li>
                            <li>child_broker_amount: DECIMAL</li>
                            <li>commission_date: DATE</li>
                            <li>status: VARCHAR</li>
                            <li>payment_date: DATE</li>
                            <li>payment_reference: VARCHAR</li>
                            <li>payment_method: VARCHAR</li>
                            <li>approved_by: INT REFERENCES users</li>
                            <li>approved_at: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>看板与工作流系统 (新增)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>workflow_stages</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>name: VARCHAR</li>
                            <li>stage_order: INT</li>
                            <li>color: VARCHAR</li>
                            <li>auto_actions: JSONB</li>
                            <li>sla_hours: INT</li>
                            <li>is_active: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>loan_tasks</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>assigned_to: INT REFERENCES users</li>
                            <li>task_type: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>due_date: TIMESTAMP</li>
                            <li>status: VARCHAR</li>
                            <li>priority: INT</li>
                        </ul>
                    </div>
                </div>

                <h3>客户门户系统 (新增)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>client_accounts</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>user_id: INT REFERENCES users</li>
                            <li>broker_id: INT REFERENCES users</li>
                            <li>portal_access: BOOLEAN</li>
                            <li>verification_status: VARCHAR</li>
                            <li>preferences: JSONB</li>
                            <li>last_login: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>document_requests</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>client_id: INT REFERENCES users</li>
                            <li>document_type: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>status: VARCHAR</li>
                            <li>due_date: DATE</li>
                            <li>uploaded_file_id: INT</li>
                        </ul>
                    </div>
                </div>

                <h3>AI/ML 与风险评估 (新增)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>risk_assessments</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>risk_score: DECIMAL</li>
                            <li>risk_factors: JSONB</li>
                            <li>model_version: VARCHAR</li>
                            <li>recommendations: TEXT</li>
                            <li>assessed_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>fact_finds</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>template_id: INT</li>
                            <li>generated_content: JSONB</li>
                            <li>ai_confidence: DECIMAL</li>
                            <li>manual_edits: JSONB</li>
                            <li>finalized_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>推荐系统 (新增)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>referral_partnerships</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>referrer_id: INT REFERENCES users</li>
                            <li>referee_id: INT REFERENCES users</li>
                            <li>partnership_type: VARCHAR</li>
                            <li>commission_split: JSONB</li>
                            <li>terms: TEXT</li>
                            <li>status: VARCHAR</li>
                            <li>valid_from: DATE</li>
                            <li>valid_to: DATE</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>referral_transactions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>partnership_id: INT</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>referral_fee: DECIMAL</li>
                            <li>status: VARCHAR</li>
                            <li>paid_date: DATE</li>
                        </ul>
                    </div>
                </div>

                <h3>客户信息收集系统 (新增)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>clients</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>broker_id: INT REFERENCES users</li>
                            <li>first_name: VARCHAR</li>
                            <li>last_name: VARCHAR</li>
                            <li>email: VARCHAR</li>
                            <li>phone: VARCHAR</li>
                            <li>date_of_birth: DATE</li>
                            <li>marital_status: VARCHAR</li>
                            <li>number_of_dependents: INT</li>
                            <li>employment_status: VARCHAR</li>
                            <li>current_stage: VARCHAR</li>
                            <li>personal_info: JSONB</li>
                            <li>preferences: JSONB</li>
                            <li>portal_access_token: VARCHAR</li>
                            <li>portal_last_accessed: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                            <li>updated_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_income</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>income_type: VARCHAR</li>
                            <li>employer_name: VARCHAR</li>
                            <li>annual_salary: DECIMAL</li>
                            <li>monthly_salary: DECIMAL</li>
                            <li>bonus_income: DECIMAL</li>
                            <li>overtime_income: DECIMAL</li>
                            <li>other_income: DECIMAL</li>
                            <li>employment_start_date: DATE</li>
                            <li>payslip_documents: JSONB</li>
                            <li>ai_extracted_data: JSONB</li>
                            <li>ai_confidence_score: DECIMAL</li>
                            <li>manual_verification: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_assets</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>asset_type: VARCHAR</li>
                            <li>asset_description: VARCHAR</li>
                            <li>estimated_value: DECIMAL</li>
                            <li>ownership_percentage: DECIMAL</li>
                            <li>property_address: VARCHAR</li>
                            <li>vehicle_details: JSONB</li>
                            <li>bank_account_details: JSONB</li>
                            <li>investment_details: JSONB</li>
                            <li>supporting_documents: JSONB</li>
                            <li>ai_extracted_value: DECIMAL</li>
                            <li>ai_confidence_score: DECIMAL</li>
                            <li>valuation_source: VARCHAR</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_liabilities</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>liability_type: VARCHAR</li>
                            <li>lender_name: VARCHAR</li>
                            <li>current_balance: DECIMAL</li>
                            <li>monthly_payment: DECIMAL</li>
                            <li>interest_rate: DECIMAL</li>
                            <li>loan_term_remaining: INT</li>
                            <li>credit_limit: DECIMAL</li>
                            <li>account_number: VARCHAR</li>
                            <li>liability_details: JSONB</li>
                            <li>ai_extracted_data: JSONB</li>
                            <li>ai_confidence_score: DECIMAL</li>
                            <li>supporting_documents: JSONB</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>文档处理与AI系统 (新增)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>uploaded_documents</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>document_type: VARCHAR</li>
                            <li>document_category: VARCHAR</li>
                            <li>original_filename: VARCHAR</li>
                            <li>s3_file_path: VARCHAR</li>
                            <li>file_size: BIGINT</li>
                            <li>mime_type: VARCHAR</li>
                            <li>ai_processing_status: VARCHAR</li>
                            <li>ai_processing_started_at: TIMESTAMP</li>
                            <li>ai_processing_completed_at: TIMESTAMP</li>
                            <li>ai_extracted_text: TEXT</li>
                            <li>ai_structured_data: JSONB</li>
                            <li>ai_confidence_scores: JSONB</li>
                            <li>manual_review_required: BOOLEAN</li>
                            <li>manual_review_completed: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>ai_processing_logs</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>document_id: INT REFERENCES uploaded_documents</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>processing_type: VARCHAR</li>
                            <li>ai_model_version: VARCHAR</li>
                            <li>processing_started_at: TIMESTAMP</li>
                            <li>processing_completed_at: TIMESTAMP</li>
                            <li>extraction_results: JSONB</li>
                            <li>confidence_metrics: JSONB</li>
                            <li>errors_encountered: JSONB</li>
                            <li>processing_duration_ms: INT</li>
                            <li>success: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>factfind_templates</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>template_name: VARCHAR</li>
                            <li>template_version: VARCHAR</li>
                            <li>template_structure: JSONB</li>
                            <li>field_mappings: JSONB</li>
                            <li>validation_rules: JSONB</li>
                            <li>compliance_requirements: JSONB</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_by: INT REFERENCES users</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_factfinds</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>template_id: INT REFERENCES factfind_templates</li>
                            <li>ai_generated_data: JSONB</li>
                            <li>client_completed_data: JSONB</li>
                            <li>broker_reviewed_data: JSONB</li>
                            <li>final_factfind: JSONB</li>
                            <li>completion_percentage: DECIMAL</li>
                            <li>ai_confidence_overall: DECIMAL</li>
                            <li>requires_manual_review: BOOLEAN</li>
                            <li>broker_approved: BOOLEAN</li>
                            <li>client_signed_off: BOOLEAN</li>
                            <li>generated_at: TIMESTAMP</li>
                            <li>finalized_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>第三方集成系统 (新增)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>quickli_submissions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>factfind_id: INT REFERENCES client_factfinds</li>
                            <li>submission_data: JSONB</li>
                            <li>quickli_submission_id: VARCHAR</li>
                            <li>submitted_at: TIMESTAMP</li>
                            <li>response_received_at: TIMESTAMP</li>
                            <li>lender_recommendations: JSONB</li>
                            <li>rate_comparisons: JSONB</li>
                            <li>best_recommendations: JSONB</li>
                            <li>broker_selected_products: JSONB</li>
                            <li>client_approved_products: JSONB</li>
                            <li>status: VARCHAR</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>applyonline_applications</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>quickli_submission_id: INT REFERENCES quickli_submissions</li>
                            <li>selected_lender: VARCHAR</li>
                            <li>selected_product: JSONB</li>
                            <li>application_package: JSONB</li>
                            <li>applyonline_app_id: VARCHAR</li>
                            <li>submitted_at: TIMESTAMP</li>
                            <li>current_status: VARCHAR</li>
                            <li>lender_response: JSONB</li>
                            <li>conditional_approval: JSONB</li>
                            <li>final_approval: JSONB</li>
                            <li>settlement_date: DATE</li>
                            <li>commission_triggered: BOOLEAN</li>
                            <li>commission_processed_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>integration_logs</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>integration_type: VARCHAR</li>
                            <li>external_system: VARCHAR</li>
                            <li>request_data: JSONB</li>
                            <li>response_data: JSONB</li>
                            <li>request_timestamp: TIMESTAMP</li>
                            <li>response_timestamp: TIMESTAMP</li>
                            <li>http_status_code: INT</li>
                            <li>success: BOOLEAN</li>
                            <li>error_message: TEXT</li>
                            <li>retry_count: INT</li>
                        </ul>
                    </div>
                </div>

                <h3>增强看板工作流系统 (已更新)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>kanban_stages</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>stage_name: VARCHAR</li>
                            <li>stage_order: INT</li>
                            <li>stage_color: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>required_actions: JSONB</li>
                            <li>auto_progression_rules: JSONB</li>
                            <li>sla_hours: INT</li>
                            <li>notification_triggers: JSONB</li>
                            <li>is_active: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_stage_history</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>from_stage: VARCHAR</li>
                            <li>to_stage: VARCHAR</li>
                            <li>moved_by: INT REFERENCES users</li>
                            <li>moved_at: TIMESTAMP</li>
                            <li>duration_in_previous_stage_hours: INT</li>
                            <li>completion_percentage: DECIMAL</li>
                            <li>notes: TEXT</li>
                            <li>automated_move: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>client_tasks</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>client_id: INT REFERENCES clients</li>
                            <li>task_type: VARCHAR</li>
                            <li>task_description: TEXT</li>
                            <li>assigned_to: INT REFERENCES users</li>
                            <li>priority: INT</li>
                            <li>due_date: TIMESTAMP</li>
                            <li>status: VARCHAR</li>
                            <li>completion_notes: TEXT</li>
                            <li>completed_by: INT REFERENCES users</li>
                            <li>completed_at: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>

        <!-- Feature Design Tab -->
        <div id="feature-design" class="tab-content active">
            <div class="alert alert-info">
                <strong>📅 最后更新:</strong> 2025年8月<br>
                <strong>🎯 目的:</strong> 从微服务到单体架构的完整系统重新设计，包含新功能<br>
                <strong>📊 状态:</strong> 需求分析阶段
            </div>

            <h2>📌 摘要</h2>
            <div class="section">
                <p><strong>HarbourX</strong> 是一个全面的以客户为中心的金融服务平台，彻底改变了经纪人如何收集、处理和管理贷款申请的客户信息。该系统结合了智能文档处理、AI驱动的数据提取以及与行业领先平台（如Quickli和ApplyOnline）的无缝集成，以简化整个贷款发起流程。</p>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h3>🎯 关键目标</h3>
                        <ul>
                            <li>简化客户信息收集</li>
                            <li>使用AI自动化文档处理</li>
                            <li>与Quickli集成（40+贷款机构）</li>
                            <li>无缝ApplyOnline集成</li>
                            <li>减少90%的手动数据输入</li>
                            <li>提高经纪人生产力</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3>⚡ 核心工作流</h3>
                        <ul>
                            <li>以客户为中心的看板</li>
                            <li>AI文档分析与提取</li>
                            <li>客户填写的Factfind模板</li>
                            <li>客户门户获取缺失信息</li>
                            <li>Quickli集成进行贷款比较</li>
                            <li>ApplyOnline申请提交</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3>🤖 AI驱动功能</h3>
                        <ul>
                            <li>工资单收入提取</li>
                            <li>从文档进行资产估值</li>
                            <li>负债评估</li>
                            <li>OCR文档处理</li>
                            <li>自动填充客户信息</li>
                            <li>合规验证</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h2>🏗️ 系统架构</h2>
            <div class="section">
                <div class="mermaid">
flowchart TB
    subgraph "Client Layer"
        WEB[Web Browser]
        MOB[Mobile Browser]
        API[External APIs]
    end
    
    subgraph "Application Layer"
        APP[HarbourX Monolith]
        
        subgraph "Core Modules"
            AUTH[Authentication]
            USER[User Management]
            LOAN[Loan Processing]
            COMM[Commissions]
            PORT[Client Portal]
        end
        
        subgraph "New Features"
            KAN[Kanban Board]
            REF[Referral System]
            AI[AI/ML Engine]
            DOC[Document Manager]
            SIGN[Digital Signatures]
        end
    end
    
    subgraph "External Services"
        QUICKLI[Quickli Platform]
        APPLYONLINE[ApplyOnline]
        LEND[Lender APIs]
        CREDIT[Credit Check]
        KYC[Identity Verification]
        EMAIL[Email Service]
        SMS[SMS Gateway]
    end
    
    subgraph "Data Layer"
        PG[(PostgreSQL)]
        REDIS[(Redis Cache)]
        S3[Object Storage]
    end
    
    WEB --> APP
    MOB --> APP
    API --> APP
    
    APP --> PG
    APP --> REDIS
    APP --> S3
    
    APP --> QUICKLI
    APP --> APPLYONLINE
    APP --> LEND
    APP --> CREDIT
    APP --> KYC
    APP --> EMAIL
    APP --> SMS
    
    style APP fill:#667eea,color:#fff
    style PG fill:#336791,color:#fff
    style REDIS fill:#dc382d,color:#fff
                </div>
            </div>

            <h2>👤 用户旅程图</h2>
            <div class="section">
                
                <h3>🎯 简化经纪人旅程 - 优化流程</h3>
                <div class="diagram-container">
                    <div class="journey-flow">
                        <div class="flow-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>新客户联系</h4>
                                <p>经纪人接收新客户咨询</p>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>创建客户卡片</h4>
                                <p>发送门户链接给客户</p>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>客户门户</h4>
                                <p>客户上传文档</p>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>AI自动处理</h4>
                                <p>AI识别文档信息</p>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>Quickli分析</h4>
                                <p>40+贷款机构比较</p>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-number">6</div>
                            <div class="step-content">
                                <h4>展示并批准</h4>
                                <p>选择最佳方案</p>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-number">7</div>
                            <div class="step-content">
                                <h4>ApplyOnline提交</h4>
                                <p>申请提交</p>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">
                            <div class="step-number">8</div>
                            <div class="step-content">
                                <h4>结算与佣金</h4>
                                <p>完成贷款流程</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h3>📊 简化客户看板流程</h3>
                <div class="diagram-container">
                    <div class="kanban-flow">
                        <div class="kanban-step">
                            <div class="step-icon">👤</div>
                            <h4>新客户</h4>
                            <p>创建客户档案</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="kanban-step">
                            <div class="step-icon">📄</div>
                            <h4>文档上传</h4>
                            <p>AI处理文档</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="kanban-step">
                            <div class="step-icon">📋</div>
                            <h4>信息收集完成</h4>
                            <p>审查与完善</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="kanban-step">
                            <div class="step-icon">🔍</div>
                            <h4>Quickli分析</h4>
                            <p>贷款机构比较</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="kanban-step">
                            <div class="step-icon">📝</div>
                            <h4>申请提交</h4>
                            <p>提交贷款申请</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="kanban-step">
                            <div class="step-icon">✅</div>
                            <h4>结算</h4>
                            <p>完成贷款流程</p>
                        </div>
                    </div>
                </div>

                <h3>🤖 AI文档处理</h3>
                <div class="diagram-container">
                    <div class="ai-processing-flow">
                        <div class="ai-step">
                            <div class="step-icon">📤</div>
                            <h4>上传文档</h4>
                            <p>客户上传各种文档</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="ai-step">
                            <div class="step-icon">🔍</div>
                            <h4>文档检测</h4>
                            <p>AI识别文档类型</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="ai-step">
                            <div class="step-icon">💰</div>
                            <h4>提取收入数据</h4>
                            <p>从工资单提取收入信息</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="ai-step">
                            <div class="step-icon">🏠</div>
                            <h4>提取资产信息</h4>
                            <p>从文档提取资产价值</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="ai-step">
                            <div class="step-icon">💳</div>
                            <h4>提取负债数据</h4>
                            <p>从文档提取负债信息</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="ai-step">
                            <div class="step-icon">✅</div>
                            <h4>数据验证</h4>
                            <p>经纪人审查与验证</p>
                        </div>
                    </div>
                </div>

                <h3>🔄 第三方集成流程</h3>
                <div class="diagram-container">
                    <div class="integration-flow">
                        <div class="integration-step">
                            <div class="step-icon">👤</div>
                            <h4>客户</h4>
                            <p>完成信息收集</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="integration-step">
                            <div class="step-icon">🏢</div>
                            <h4>HarbourX</h4>
                            <p>客户填写或AI识别</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="integration-step">
                            <div class="step-icon">🔍</div>
                            <h4>Quickli</h4>
                            <p>分析40+贷款机构</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="integration-step">
                            <div class="step-icon">📋</div>
                            <h4>ApplyOnline</h4>
                            <p>提交申请</p>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="integration-step">
                            <div class="step-icon">🏦</div>
                            <h4>贷款机构</h4>
                            <p>审批与结算</p>
                        </div>
                    </div>
                    <div class="integration-details">
                        <h4>详细流程说明：</h4>
                        <ul>
                            <li>客户在HarbourX完成信息收集</li>
                            <li>客户手动填写或AI自动识别文档信息</li>
                            <li>数据发送到Quickli进行分析</li>
                            <li>Quickli返回贷款推荐</li>
                            <li>客户选择并批准方案</li>
                            <li>通过ApplyOnline提交申请</li>
                            <li>贷款机构处理并返回状态</li>
                            <li>系统触发结算和佣金处理</li>
                        </ul>
                    </div>
                </div>

                <h3>👥 客户门户用户体验</h3>
                <div class="diagram-container">
                    <div class="portal-experience">
                        <div class="experience-phase">
                            <h4>📝 注册阶段</h4>
                            <div class="phase-steps">
                                <div class="exp-step">
                                    <span class="step-emoji">📧</span>
                                    <span>接收门户链接</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">👤</span>
                                    <span>创建账户</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">🔐</span>
                                    <span>验证身份</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="experience-phase">
                            <h4>📊 信息收集阶段</h4>
                            <div class="phase-steps">
                                <div class="exp-step">
                                    <span class="step-emoji">📱</span>
                                    <span>查看仪表板</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">💰</span>
                                    <span>上传工资单</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">🏠</span>
                                    <span>上传资产文档</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">💳</span>
                                    <span>上传负债文档</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">🤖</span>
                                    <span>获取AI反馈</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="experience-phase">
                            <h4>🔍 缺口完成阶段</h4>
                            <div class="phase-steps">
                                <div class="exp-step">
                                    <span class="step-emoji">📋</span>
                                    <span>审查缺失信息</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">✏️</span>
                                    <span>填写个人详情</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">💕</span>
                                    <span>添加婚姻状况</span>
                                    <span class="rating"></span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">✅</span>
                                    <span>提交完成</span>
                                    <span class="rating"></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="experience-phase">
                            <h4>👀 审查与批准阶段</h4>
                            <div class="phase-steps">
                                <div class="exp-step">
                                    <span class="step-emoji">🔍</span>
                                    <span>查看贷款选项</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">📊</span>
                                    <span>比较利率</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">👍</span>
                                    <span>选择首选方案</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">✍️</span>
                                    <span>批准申请</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="experience-phase">
                            <h4>📈 跟踪阶段</h4>
                            <div class="phase-steps">
                                <div class="exp-step">
                                    <span class="step-emoji">📊</span>
                                    <span>监控进度</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">📢</span>
                                    <span>接收更新</span>
                                </div>
                                <div class="exp-step">
                                    <span class="step-emoji">🎉</span>
                                    <span>最终通知</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="diagram-container">
                <h2>🚀 系统功能与能力</h2>
                
                <div class="domain-grid">
                    <div class="domain-card" style="border-top: 4px solid #3498db;">
                        <h3>1. 以客户为中心的看板系统</h3>
                        <p><strong>核心实体：当前经纪人的每个客户</strong></p>
                        <ul>
                            <li>客户卡片代表个人，而非贷款</li>
                            <li>从新客户到结算的11阶段工作流</li>
                            <li>信息收集的可视化进度跟踪</li>
                            <li>拖拽式客户管理</li>
                            <li>实时状态更新</li>
                            <li>基于已完成任务的自动化阶段推进</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #e67e22;">
                        <h3>2. AI驱动的文档处理</h3>
                        <p><strong>所有上传文件的智能自动化：</strong></p>
                        <ul>
                            <li><strong>工资单分析：</strong> 提取工资、奖金、加班费、扣除额</li>
                            <li><strong>资产识别：</strong> 房产估值、车辆价值、储蓄账户</li>
                            <li><strong>负债评估：</strong> 现有贷款、信用卡限额、承诺</li>
                            <li><strong>OCR处理：</strong> 将所有文档类型转换为结构化数据</li>
                            <li><strong>数据验证：</strong> 交叉引用和验证提取的信息</li>
                            <li><strong>AI辅助信息识别：</strong> 从文档自动识别信息</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #2ecc71;">
                        <h3>3. 增强客户门户</h3>
                        <p><strong>简化的信息收集界面：</strong></p>
                        <ul>
                            <li>个人信息收集（基本详情）</li>
                            <li>收入文档上传（工资单、纳税申报表）</li>
                            <li>资产文档（房产、车辆、储蓄）</li>
                            <li>负债声明（现有贷款、信用卡）</li>
                            <li>非可提取数据的缺口完成（婚姻状况、偏好）</li>
                            <li>实时AI处理反馈</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #4caf50;">
                        <h3>4. Quickli平台集成</h3>
                        <p><strong>40+贷款机构计算器和比较引擎：</strong></p>
                        <ul>
                            <li>Factfind数据自动传输</li>
                            <li>实时利率和产品比较</li>
                            <li>最佳匹配贷款推荐</li>
                            <li>全面的贷款机构分析</li>
                            <li>成本比较和费用分析</li>
                            <li>客户友好的推荐报告</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #ff9800;">
                        <h3>5. ApplyOnline集成</h3>
                        <p><strong>无缝申请提交平台：</strong></p>
                        <ul>
                            <li>从Quickli选择直接交接</li>
                            <li>自动化申请包编译</li>
                            <li>贷款机构特定的提交格式</li>
                            <li>实时申请状态跟踪</li>
                            <li>贷款机构查询的通信中心</li>
                            <li>结算协调和佣金触发</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #9c27b0;">
                        <h3>6. 客户信息收集与AI识别</h3>
                        <p><strong>完整的客户档案编译：</strong></p>
                        <ul>
                            <li>客户在portal手动填写信息</li>
                            <li>AI自动识别上传文档信息</li>
                            <li>客户完成的缺口信息</li>
                            <li>监管合规验证</li>
                            <li>经纪人审查和定制</li>
                            <li>导出到多种格式（Quickli、ApplyOnline、PDF）</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #f39c12;">
                        <h3>7. 佣金与结算系统</h3>
                        <p><strong>端到端佣金处理：</strong></p>
                        <ul>
                            <li>结算触发的佣金计算</li>
                            <li>自动化RCTI生成</li>
                            <li>推荐佣金分成</li>
                            <li>多层经纪人层次结构</li>
                            <li>付款跟踪和对账</li>
                            <li>佣金报告和分析</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #607d8b;">
                        <h3>8. 数据智能与分析</h3>
                        <p><strong>商业智能和洞察：</strong></p>
                        <ul>
                            <li>客户转化漏斗分析</li>
                            <li>AI处理准确性指标</li>
                            <li>Quickli推荐成功率</li>
                            <li>ApplyOnline申请结果</li>
                            <li>经纪人绩效仪表板</li>
                            <li>贷款成功的预测分析</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="diagram-container">
                <h2>为什么选择这种架构？</h2>
                
                <div class="explanation-box" style="background: #fadbd8; border-left: 4px solid #c62828;">
                    <h3>⚠️ 当前系统限制</h3>
                    <p><strong>现有微服务架构的关键问题：</strong></p>
                    
                    <h4>1. 数据重复和不一致</h4>
                    <ul>
                        <li>相同的经纪人数据存在于5+个不同数据库中</li>
                        <li>RCTI数据分散在多个服务中</li>
                        <li>数据同步失败导致不一致</li>
                        <li>关键业务数据没有单一真实来源</li>
                    </ul>
                    
                    <h4>2. 过度设计的代码</h4>
                    <ul>
                        <li>大多数服务是AI生成的，过度复杂</li>
                        <li>简单的CRUD操作有1000+行样板代码</li>
                        <li>难以理解和维护</li>
                        <li>错误修复需要在多个服务中进行更改</li>
                    </ul>
                    
                    <h4>3. 基础设施过度配置</h4>
                    <ul>
                        <li><strong>K8s严重过度配置：</strong> CPU使用率&lt;20%，网络&lt;20%，数据库&lt;20%</li>
                        <li>在pod中管理CSV文件脆弱且丑陋</li>
                        <li>PostgreSQL在pod中运行，没有适当的备份</li>
                        <li>简单工作流的复杂编排</li>
                    </ul>
                    
                    <h4>4. 没有监控或可观测性</h4>
                    <ul>
                        <li>没有集中监控仪表板</li>
                        <li>无法跟踪系统健康状态或性能</li>
                        <li>调试需要检查11个不同的日志流</li>
                        <li>没有失败或问题的警报</li>
                    </ul>
                </div>
                
                <div class="explanation-box" style="background: #e8f6f3; border-left: 4px solid #16a085;">
                    <h3>✅ 解决方案：单体架构</h3>
                    <p><strong>新架构如何解决这些问题：</strong></p>
                    
                    <h4>1. 数据统一</h4>
                    <ul>
                        <li><strong>之前：</strong> 11个数据库，数据重复且不一致</li>
                        <li><strong>之后：</strong> 单一PostgreSQL数据库，标准化架构</li>
                        <li><strong>结果：</strong> 零数据重复，100%一致性</li>
                    </ul>
                    
                    <h4>2. 简化代码库</h4>
                    <ul>
                        <li><strong>之前：</strong> 过度复杂的AI生成服务</li>
                        <li><strong>之后：</strong> 清洁、可维护的单体代码库</li>
                        <li><strong>结果：</strong> 代码减少60%，更容易理解和调试</li>
                    </ul>
                    
                    <h4>3. 合理的基础设施规模</h4>
                    <ul>
                        <li><strong>之前：</strong> K8s资源利用率&lt;20%</li>
                        <li><strong>之后：</strong> 在2-3个VM或容器上简单部署</li>
                        <li><strong>结果：</strong> 基础设施成本降低80%</li>
                    </ul>
                    
                    <h4>4. 内置监控</h4>
                    <ul>
                        <li><strong>之前：</strong> 没有监控或可观测性</li>
                        <li><strong>之后：</strong> 从一开始就有Grafana + Prometheus</li>
                        <li><strong>结果：</strong> 对系统健康状态和性能的完全可见性</li>
                    </ul>
                    
                    <h4>5. 额外好处</h4>
                    <ul>
                        <li>所有操作的ACID事务</li>
                        <li>服务间无网络延迟</li>
                        <li>更简单的部署和维护</li>
                        <li>新功能开发更快</li>
                        <li>简单的本地开发环境</li>
                    </ul>
                </div>
            </div>

            <div class="diagram-container">
                <h2>完整系统架构</h2>
                <div class="system-architecture-layers">
                    <div class="arch-layer-card">
                        <h3>第1层：用户界面</h3>
                        <div class="layer-components">
                            <div class="component">
                                <span class="component-icon">👤</span>
                                <h4>客户门户</h4>
                                <p>为贷款申请人提供</p>
                            </div>
                            <div class="component">
                                <span class="component-icon">📊</span>
                                <h4>看板</h4>
                                <p>为经纪人提供</p>
                            </div>
                            <div class="component">
                                <span class="component-icon">📈</span>
                                <h4>仪表板</h4>
                                <p>为经纪人提供</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="arch-layer-card">
                        <h3>第2层：核心功能</h3>
                        <div class="layer-components">
                            <div class="component">
                                <span class="component-icon">👥</span>
                                <h4>用户管理</h4>
                            </div>
                            <div class="component">
                                <span class="component-icon">🏢</span>
                                <h4>公司管理</h4>
                            </div>
                            <div class="component">
                                <span class="component-icon">🤝</span>
                                <h4>推荐系统</h4>
                            </div>
                            <div class="component">
                                <span class="component-icon">🤖</span>
                                <h4>AI引擎</h4>
                                <ul>
                                    <li>贷款摘要</li>
                                    <li>合规生成</li>
                                    <li>最佳利益义务</li>
                                    <li>客户信息提取</li>
                                    <li>财务分析</li>
                                    <li>工资单分析</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="arch-layer-card">
                        <h3>第3层：业务逻辑</h3>
                        <div class="layer-components">
                            <div class="component">
                                <span class="component-icon">📄</span>
                                <h4>贷款处理</h4>
                            </div>
                            <div class="component">
                                <span class="component-icon">✅</span>
                                <h4>结算管理</h4>
                            </div>
                            <div class="component">
                                <span class="component-icon">📤</span>
                                <h4>文件处理</h4>
                                <ul>
                                    <li>DOCX, PDF, Excel, CSV</li>
                                    <li>来自贷款机构的RCTI</li>
                                    <li>多格式解析</li>
                                    <li>数据提取</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="arch-layer-card">
                        <h3>第4层：财务处理</h3>
                        <div class="layer-components">
                            <div class="component">
                                <span class="component-icon">💰</span>
                                <h4>前期佣金</h4>
                            </div>
                            <div class="component">
                                <span class="component-icon">🔄</span>
                                <h4>后续佣金</h4>
                            </div>
                            <div class="component">
                                <span class="component-icon">🧾</span>
                                <h4>RCTI</h4>
                            </div>
                        </div>
                    </div>
                    
                    <div class="arch-layer-card">
                        <h3>第5层：数据存储</h3>
                        <div class="layer-components">
                            <div class="component">
                                <span class="component-icon">🗄️</span>
                                <h4>PostgreSQL</h4>
                            </div>
                            <div class="component">
                                <span class="component-icon">📊</span>
                                <h4>MongoDB</h4>
                            </div>
                            <div class="component">
                                <span class="component-icon">☁️</span>
                                <h4>S3存储</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="summary-box">
                <h3>📋 实施路线图与任务</h3>
                
                <div class="domain-grid">
                    <div class="domain-card" style="border-top: 4px solid #e74c3c;">
                        <h3>阶段1：UI/UX设计</h3>
                        <h4>设计系统与用户体验</h4>
                        <ul>
                            <li>用户研究与角色</li>
                            <li>信息架构</li>
                            <li>所有模块的线框图</li>
                            <li>设计系统与组件库</li>
                            <li>看板UI设计</li>
                            <li>客户门户界面</li>
                            <li>移动响应式设计</li>
                            <li>可用性测试</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #3498db;">
                        <h3>阶段2：数据库架构</h3>
                        <h4>数据层基础</h4>
                        <ul>
                            <li>设计统一数据库架构</li>
                            <li>定义所有实体关系</li>
                            <li>从微服务创建迁移脚本</li>
                            <li>设置数据库索引和约束</li>
                            <li>实现审计日志结构</li>
                            <li>数据去重策略</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #9c27b0;">
                        <h3>阶段3：基础架构搭建</h3>
                        <h4>技术基础设施</h4>
                        <ul>
                            <li>数据库设置（PostgreSQL + MongoDB）</li>
                            <li>Go/Spring Boot项目结构</li>
                            <li>基本认证系统</li>
                            <li>AWS S3文件存储配置</li>
                            <li>React项目设置（TypeScript）</li>
                            <li>基础基础设施就绪</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #2ecc71;">
                        <h3>阶段4：核心迁移</h3>
                        <h4>单体开发</h4>
                        <ul>
                            <li>用户与认证系统</li>
                            <li>公司与角色管理</li>
                            <li>贷款处理管道</li>
                            <li>佣金计算</li>
                            <li>RCTI生成</li>
                            <li>数据迁移与清理</li>
                            <li>移除K8s复杂性</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #f39c12;">
                        <h3>阶段5：系统集成与测试</h3>
                        <h4>集成测试与优化</h4>
                        <ul>
                            <li>佣金流程端到端测试</li>
                            <li>文件上传压力测试</li>
                            <li>看板用户测试</li>
                            <li>错误修复和优化</li>
                            <li>生产就绪里程碑1</li>
                            <li>性能优化与监控</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #e67e22;">
                        <h3>阶段6：新功能</h3>
                        <h4>功能实施</h4>
                        <ul>
                            <li>带分成的推荐系统</li>
                            <li>看板贷款管理</li>
                            <li>客户门户与上传</li>
                            <li>数字签名</li>
                            <li><strong>AI贷款摘要</strong> - 自动生成全面贷款摘要</li>
                            <li><strong>合规文件生成</strong> - 自动化监管文档</li>
                            <li><strong>最佳利益义务</strong> - 合规检查与建议</li>
                            <li><strong>客户信息提取</strong> - 从文档提取客户数据</li>
                            <li><strong>财务报告分析</strong> - 自动解析银行对账单</li>
                            <li><strong>工资单分析</strong> - 收入验证与提取</li>
                            <li>高级文件处理（DOCX、PDF、Excel、CSV、RCTI）</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    
           



                

               

          

        <div class="section" style="text-align: center; margin-top: 50px; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px;">
            <h2 style="color: white; border: none;">🚢 HarbourX</h2>
            <p style="font-size: 1.2em; margin: 20px 0;">结合数据库架构和功能规范的完整系统设计</p>
            <p style="opacity: 0.9;">© 2024 HarbourX - 综合设计文档 v1.0</p>
        </div>
</div>

    <script>


        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                padding: 20,
                nodeSpacing: 50,
                rankSpacing: 80
            },
            er: {
                layoutDirection: 'TB',
                minEntityWidth: 100,
                minEntityHeight: 75,
                entityPadding: 15,
                stroke: '#333',
                fill: '#fff'
            },
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#5a67d8',
                lineColor: '#333',
                sectionBkgColor: '#f7fafc',
                altSectionBkgColor: '#edf2f7',
                gridColor: '#e2e8f0',
                cScale0: '#667eea',
                cScale1: '#764ba2',
                cScale2: '#3498db'
            }
        });
        
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('HarbourX 系统设计文档已加载完成');
        });
    </script>
</body>
</html>