<!DOCTYPE html>
<html>
<head>
    <title>HarbourX - Complete System Design & Architecture</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            border-bottom: 3px solid #eee;
            margin-bottom: 30px;
            gap: 0;
        }
        .tab-button {
            background: #f8f9fa;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
            color: #6c757d;
        }
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .tab-button:hover:not(.active) {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* Common Styles */
        h1 {
            color: #2c3e50;
            text-align: center;
            font-size: 2.5em;
            padding-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            margin-bottom: 0;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 4px solid #667eea;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }
        .feature-card h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .database-table {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .database-table h4 {
            margin-top: 0;
            color: #495057;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        .field-list {
            list-style: none;
            padding: 0;
        }
        .field-list li {
            padding: 5px 0;
            border-bottom: 1px solid #f1f3f5;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        .tech-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }
        .timeline {
            position: relative;
            padding-left: 40px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #667eea;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -30px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }
        .status-complete {
            background: #d4edda;
            color: #155724;
        }
        .status-in-progress {
            background: #fff3cd;
            color: #856404;
        }
        .status-pending {
            background: #f8d7da;
            color: #721c24;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        .alert-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }
        .diagram-container {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .summary-box {
            background: #e8f6f3;
            border-left: 4px solid #16a085;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .domain-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .domain-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .user-domain {
            border-top: 4px solid #3498db;
        }
        .business-domain {
            border-top: 4px solid #27ae60;
        }
        .explanation-box {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .mermaid {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            min-height: 600px;
            overflow-x: auto;
            overflow-y: hidden;
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .mermaid svg {
            max-width: 100%;
            height: auto;
            min-width: 800px;
        }
        .mermaid a {
            color: #1976d2;
            text-decoration: underline;
            font-size: 10px;
        }
        @media (max-width: 768px) {
            .mermaid {
                min-height: 400px;
            }
            .mermaid svg {
                min-width: 600px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö¢ HarbourX - Complete System Design & Architecture</h1>
        
        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'database-design')">üóÑÔ∏è Database Design</button>
            <button class="tab-button" onclick="openTab(event, 'feature-design')">üéØ Feature Design</button>
        </div>

        <!-- Database Design Tab -->
        <div id="database-design" class="tab-content active">
            <div class="alert alert-info">
                <strong>üìÖ Last Updated:</strong> August 2025<br>
                <strong>üéØ Purpose:</strong> Complete system redesign from microservices to monolithic architecture with new features<br>
                <strong>üìä Status:</strong> Design Phase Complete, Ready for Implementation
            </div>

            <h2>üìå Executive Summary</h2>
            <div class="section">
                <p><strong>HarbourX</strong> is a comprehensive financial services platform for broker commission management, loan processing, and client engagement. This document outlines the complete system redesign, migrating from an over-engineered microservices architecture to a streamlined monolithic application.</p>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h3>üéØ Key Objectives</h3>
                        <ul>
                            <li>Eliminate data duplication</li>
                            <li>Reduce infrastructure costs by 80%</li>
                            <li>Improve system performance</li>
                            <li>Add modern features</li>
                            <li>Enhance user experience</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3>‚ö° Core Features</h3>
                        <ul>
                            <li>Kanban loan management</li>
                            <li>Client self-service portal</li>
                            <li>Referral system</li>
                            <li>AI-powered risk assessment</li>
                            <li>Digital signatures</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3>üîß Technical Improvements</h3>
                        <ul>
                            <li>Single database (PostgreSQL)</li>
                            <li>Simplified deployment</li>
                            <li>Built-in monitoring</li>
                            <li>ACID transactions</li>
                            <li>60% less code</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h2>üèóÔ∏è System Architecture</h2>
            <div class="section">
                <div class="mermaid">
flowchart TB
    subgraph "Client Layer"
        WEB[Web Browser]
        MOB[Mobile Browser]
        API[External APIs]
    end
    
    subgraph "Application Layer"
        APP[HarbourX Monolith]
        
        subgraph "Core Modules"
            AUTH[Authentication]
            USER[User Management]
            LOAN[Loan Processing]
            COMM[Commissions]
            PORT[Client Portal]
        end
        
        subgraph "New Features"
            KAN[Kanban Board]
            REF[Referral System]
            AI[AI/ML Engine]
            DOC[Document Manager]
            SIGN[Digital Signatures]
        end
    end
    
    subgraph "Data Layer"
        PG[(PostgreSQL)]
        REDIS[(Redis Cache)]
        S3[Object Storage]
    end
    
    subgraph "External Services"
        LEND[Lender APIs]
        CREDIT[Credit Check]
        KYC[Identity Verification]
        EMAIL[Email Service]
        SMS[SMS Gateway]
    end
    
    WEB --> APP
    MOB --> APP
    API --> APP
    
    APP --> PG
    APP --> REDIS
    APP --> S3
    
    APP --> LEND
    APP --> CREDIT
    APP --> KYC
    APP --> EMAIL
    APP --> SMS
    
    style APP fill:#667eea,color:#fff
    style PG fill:#336791,color:#fff
    style REDIS fill:#dc382d,color:#fff
                </div>
            </div>

            <h2>üíæ Database Schema - Complete Design</h2>
            <div class="section">
                <h3>Core User & Identity System</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>users</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>email: VARCHAR UNIQUE</li>
                            <li>username: VARCHAR UNIQUE</li>
                            <li>first_name: VARCHAR</li>
                            <li>last_name: VARCHAR</li>
                            <li>phone: VARCHAR</li>
                            <li>password_hash: VARCHAR</li>
                            <li>professional_info: JSONB</li>
                            <li>avatar_url: VARCHAR</li>
                            <li>preferences: JSONB</li>
                            <li>is_email_verified: BOOLEAN</li>
                            <li>is_active: BOOLEAN</li>
                            <li>last_login: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>roles</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>name: VARCHAR UNIQUE</li>
                            <li>description: TEXT</li>
                            <li>properties: JSONB</li>
                            <li>config: JSONB</li>
                            <li>parent_role_id: INT REFERENCES roles</li>
                            <li>is_system_role: BOOLEAN</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>permissions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>resource: VARCHAR</li>
                            <li>action: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>user_roles</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>user_id: INT REFERENCES users</li>
                            <li>role_id: INT REFERENCES roles</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>granted_by: INT REFERENCES users</li>
                            <li>granted_at: TIMESTAMP</li>
                            <li>expires_at: TIMESTAMP</li>
                            <li>is_active: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>role_permissions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>role_id: INT REFERENCES roles</li>
                            <li>permission_id: INT REFERENCES permissions</li>
                            <li>conditions: JSONB</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Company & Relationship System</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>company_types</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>type_code: VARCHAR UNIQUE</li>
                            <li>type_name: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>required_fields: JSONB</li>
                            <li>allowed_features: JSONB</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>companies</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>company_type_id: INT REFERENCES company_types</li>
                            <li>name: VARCHAR</li>
                            <li>trading_name: VARCHAR</li>
                            <li>abn: VARCHAR</li>
                            <li>acn: VARCHAR</li>
                            <li>contact_info: JSONB</li>
                            <li>banking_info: JSONB</li>
                            <li>extended_data: JSONB</li>
                            <li>default_commission_model_id: INT</li>
                            <li>default_fee_model_id: INT</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>user_companies</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>role_in_company: VARCHAR</li>
                            <li>broker_code: VARCHAR UNIQUE</li>
                            <li>commission_split_percentage: DECIMAL</li>
                            <li>position_title: VARCHAR</li>
                            <li>department: VARCHAR</li>
                            <li>start_date: DATE</li>
                            <li>end_date: DATE</li>
                            <li>is_primary: BOOLEAN</li>
                            <li>status: VARCHAR</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>broker_relationships</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>parent_user_id: INT REFERENCES users</li>
                            <li>child_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>relationship_type: VARCHAR</li>
                            <li>parent_split_percentage: DECIMAL</li>
                            <li>child_split_percentage: DECIMAL</li>
                            <li>effective_from: DATE</li>
                            <li>effective_to: DATE</li>
                            <li>status: VARCHAR</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Loan & Settlement System</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>loans</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_number: VARCHAR UNIQUE</li>
                            <li>broker_user_id: INT REFERENCES users</li>
                            <li>sub_broker_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>client_name: VARCHAR</li>
                            <li>client_info: JSONB</li>
                            <li>lender_company_id: INT REFERENCES companies</li>
                            <li>loan_product: VARCHAR</li>
                            <li>loan_amount: DECIMAL</li>
                            <li>interest_rate: DECIMAL</li>
                            <li>loan_term_months: INT</li>
                            <li>loan_purpose: VARCHAR</li>
                            <li>application_date: DATE</li>
                            <li>approval_date: DATE</li>
                            <li>settlement_date: DATE</li>
                            <li>discharge_date: DATE</li>
                            <li>status: VARCHAR</li>
                            <li>source: VARCHAR</li>
                            <li>notes: TEXT</li>
                            <li>created_at: TIMESTAMP</li>
                            <li>updated_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>settlements</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>settlement_number: VARCHAR UNIQUE</li>
                            <li>broker_user_id: INT REFERENCES users</li>
                            <li>sub_broker_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>settlement_amount: DECIMAL</li>
                            <li>settlement_date: DATE</li>
                            <li>commission_model_id: INT REFERENCES commission_models</li>
                            <li>applied_upfront_rate: DECIMAL</li>
                            <li>applied_trail_rate: DECIMAL</li>
                            <li>gross_upfront: DECIMAL</li>
                            <li>gross_trail: DECIMAL</li>
                            <li>fees_applied: JSONB</li>
                            <li>total_fees: DECIMAL</li>
                            <li>net_upfront: DECIMAL</li>
                            <li>net_trail: DECIMAL</li>
                            <li>status: VARCHAR</li>
                            <li>processed_at: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Commission System</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>commission_models</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>name: VARCHAR</li>
                            <li>code: VARCHAR UNIQUE</li>
                            <li>upfront_percentage: DECIMAL</li>
                            <li>trail_percentage: DECIMAL</li>
                            <li>model_type: VARCHAR</li>
                            <li>tier_config: JSONB</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>effective_from: DATE</li>
                            <li>effective_to: DATE</li>
                            <li>is_active: BOOLEAN</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>upfront_commissions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>settlement_id: INT REFERENCES settlements</li>
                            <li>file_upload_id: INT REFERENCES file_uploads</li>
                            <li>broker_user_id: INT REFERENCES users</li>
                            <li>sub_broker_user_id: INT REFERENCES users</li>
                            <li>company_id: INT REFERENCES companies</li>
                            <li>loan_number: VARCHAR</li>
                            <li>client_name: VARCHAR</li>
                            <li>gross_commission: DECIMAL</li>
                            <li>fees: JSONB</li>
                            <li>total_deductions: DECIMAL</li>
                            <li>net_commission: DECIMAL</li>
                            <li>gst_amount: DECIMAL</li>
                            <li>parent_broker_amount: DECIMAL</li>
                            <li>child_broker_amount: DECIMAL</li>
                            <li>commission_date: DATE</li>
                            <li>status: VARCHAR</li>
                            <li>payment_date: DATE</li>
                            <li>payment_reference: VARCHAR</li>
                            <li>payment_method: VARCHAR</li>
                            <li>approved_by: INT REFERENCES users</li>
                            <li>approved_at: TIMESTAMP</li>
                            <li>created_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Kanban & Workflow System (NEW)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>workflow_stages</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>name: VARCHAR</li>
                            <li>stage_order: INT</li>
                            <li>color: VARCHAR</li>
                            <li>auto_actions: JSONB</li>
                            <li>sla_hours: INT</li>
                            <li>is_active: BOOLEAN</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>loan_tasks</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>assigned_to: INT REFERENCES users</li>
                            <li>task_type: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>due_date: TIMESTAMP</li>
                            <li>status: VARCHAR</li>
                            <li>priority: INT</li>
                        </ul>
                    </div>
                </div>

                <h3>Client Portal System (NEW)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>client_accounts</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>user_id: INT REFERENCES users</li>
                            <li>broker_id: INT REFERENCES users</li>
                            <li>portal_access: BOOLEAN</li>
                            <li>verification_status: VARCHAR</li>
                            <li>preferences: JSONB</li>
                            <li>last_login: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>document_requests</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>client_id: INT REFERENCES users</li>
                            <li>document_type: VARCHAR</li>
                            <li>description: TEXT</li>
                            <li>status: VARCHAR</li>
                            <li>due_date: DATE</li>
                            <li>uploaded_file_id: INT</li>
                        </ul>
                    </div>
                </div>

                <h3>AI/ML & Risk Assessment (NEW)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>risk_assessments</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>risk_score: DECIMAL</li>
                            <li>risk_factors: JSONB</li>
                            <li>model_version: VARCHAR</li>
                            <li>recommendations: TEXT</li>
                            <li>assessed_at: TIMESTAMP</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>fact_finds</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>template_id: INT</li>
                            <li>generated_content: JSONB</li>
                            <li>ai_confidence: DECIMAL</li>
                            <li>manual_edits: JSONB</li>
                            <li>finalized_at: TIMESTAMP</li>
                        </ul>
                    </div>
                </div>

                <h3>Referral System (NEW)</h3>
                <div class="feature-grid">
                    <div class="database-table">
                        <h4>referral_partnerships</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>referrer_id: INT REFERENCES users</li>
                            <li>referee_id: INT REFERENCES users</li>
                            <li>partnership_type: VARCHAR</li>
                            <li>commission_split: JSONB</li>
                            <li>terms: TEXT</li>
                            <li>status: VARCHAR</li>
                            <li>valid_from: DATE</li>
                            <li>valid_to: DATE</li>
                        </ul>
                    </div>
                    
                    <div class="database-table">
                        <h4>referral_transactions</h4>
                        <ul class="field-list">
                            <li>id: SERIAL PRIMARY KEY</li>
                            <li>partnership_id: INT</li>
                            <li>loan_id: INT REFERENCES loans</li>
                            <li>referral_fee: DECIMAL</li>
                            <li>status: VARCHAR</li>
                            <li>paid_date: DATE</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h2>üöÄ Technology Stack</h2>
            <div class="section">
                <h3>Backend Technologies</h3>
                <div class="tech-stack">
                    <span class="tech-badge">Go (Golang)</span>
                    <span class="tech-badge">Java Spring Boot</span>
                    <span class="tech-badge">Gin/Echo Framework</span>
                    <span class="tech-badge">Spring Security</span>
                    <span class="tech-badge">GORM / JPA</span>
                    <span class="tech-badge">JWT Auth</span>
                    <span class="tech-badge">gRPC</span>
                    <span class="tech-badge">REST APIs</span>
                </div>

                <h3>Frontend Technologies</h3>
                <div class="tech-stack">
                    <span class="tech-badge">React 18</span>
                    <span class="tech-badge">TypeScript</span>
                    <span class="tech-badge">Material UI / Ant Design</span>
                    <span class="tech-badge">Redux Toolkit</span>
                    <span class="tech-badge">React Query</span>
                    <span class="tech-badge">React Hook Form</span>
                    <span class="tech-badge">React DnD (Kanban)</span>
                    <span class="tech-badge">Vite</span>
                </div>

                <h3>Data Storage</h3>
                <div class="tech-stack">
                    <span class="tech-badge">PostgreSQL (Primary)</span>
                    <span class="tech-badge">MongoDB (Documents)</span>
                    <span class="tech-badge">AWS S3 (Files)</span>
                    <span class="tech-badge">Redis (Cache)</span>
                    <span class="tech-badge">ElasticSearch (Search)</span>
                </div>

                <h3>AI/Automation & Integrations</h3>
                <div class="tech-stack">
                    <span class="tech-badge">n8n (Workflow Automation)</span>
                    <span class="tech-badge">OpenAI API</span>
                    <span class="tech-badge">LangChain</span>
                    <span class="tech-badge">Webhook.site</span>
                    <span class="tech-badge">SendGrid</span>
                    <span class="tech-badge">Twilio</span>
                    <span class="tech-badge">DocuSign API</span>
                </div>

                <h3>DevOps & Monitoring</h3>
                <div class="tech-stack">
                    <span class="tech-badge">Docker</span>
                    <span class="tech-badge">Kubernetes (Optional)</span>
                    <span class="tech-badge">GitHub Actions</span>
                    <span class="tech-badge">Grafana</span>
                    <span class="tech-badge">Prometheus</span>
                    <span class="tech-badge">ELK Stack</span>
                    <span class="tech-badge">Nginx</span>
                    <span class="tech-badge">Traefik</span>
                </div>
            </div>

            <h2>üó∫Ô∏è Implementation Roadmap</h2>
            <div class="section">
                <div class="alert alert-success">
                    <h3>üéØ Milestone 1: Core Business Features (Priority)</h3>
                    <strong>Focus:</strong> Commission Processing + File Upload + Kanban Board<br>
                    <strong>Timeline:</strong> 16-18 weeks<br>
                    <strong>Deliverable:</strong> Working system for commission management with visual workflow
                </div>

                <div class="timeline">
                    <div class="timeline-item">
                        <h3>Phase 1.1: Foundation Setup <span class="status-badge status-in-progress">3-4 weeks</span></h3>
                        <ul>
                            <li>Database setup (PostgreSQL + MongoDB)</li>
                            <li>Go/Spring Boot project structure</li>
                            <li>Basic authentication system</li>
                            <li>AWS S3 configuration for file storage</li>
                            <li>React project setup with TypeScript</li>
                        </ul>
                        <p><em>Deliverable: Basic infrastructure ready</em></p>
                    </div>

                    <div class="timeline-item">
                        <h3>Phase 1.2: Commission System Backend <span class="status-badge status-pending">4-5 weeks</span></h3>
                        <ul>
                            <li>Commission models & fee structures (1 week)</li>
                            <li>Upfront commission calculations (1 week)</li>
                            <li>Trail commission processing (1 week)</li>
                            <li>RCTI generation logic (1 week)</li>
                            <li>Commission splitting & broker hierarchies (1 week)</li>
                        </ul>
                        <p><em>Deliverable: Complete commission API endpoints</em></p>
                    </div>

                    <div class="timeline-item">
                        <h3>Phase 1.3: File Upload & Processing <span class="status-badge status-pending">3-4 weeks</span></h3>
                        <ul>
                            <li>Excel/CSV parser implementation (1 week)</li>
                            <li>S3 integration for file storage (0.5 weeks)</li>
                            <li>Bulk commission import logic (1.5 weeks)</li>
                            <li>File validation & error handling (1 week)</li>
                        </ul>
                        <p><em>Deliverable: Working file upload with commission import</em></p>
                    </div>

                    <div class="timeline-item">
                        <h3>Phase 1.4: Kanban Board Implementation <span class="status-badge status-pending">4-5 weeks</span></h3>
                        <ul>
                            <li>Kanban UI with React DnD (1.5 weeks)</li>
                            <li>Workflow stages configuration (1 week)</li>
                            <li>Loan status management (1 week)</li>
                            <li>Real-time updates with WebSocket (1 week)</li>
                            <li>Task assignments & notifications (0.5 weeks)</li>
                        </ul>
                        <p><em>Deliverable: Visual loan pipeline management</em></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feature Design Tab -->
        <div id="feature-design" class="tab-content">
            <div class="summary-box">
                <h3>üéØ Architecture Overview</h3>
                <p>This unified schema combines:</p>
                <ul>
                    <li><strong>User & Access Management:</strong> Users, roles, permissions, and relationships</li>
                    <li><strong>Business Domain:</strong> Companies, loans, commissions, RCTI, and file processing</li>
                    <li><strong>Key Innovation:</strong> Brokers are users with roles, companies are flexible entities</li>
                </ul>
            </div>

            <div class="diagram-container">
                <h2>üöÄ System Features & Capabilities</h2>
                
                <div class="domain-grid">
                    <div class="domain-card" style="border-top: 4px solid #e74c3c;">
                        <h3>1. Microservices ‚Üí Monolith</h3>
                        <p><strong>Current:</strong> 11 separate services with duplicated data</p>
                        <p><strong>New:</strong> Unified database with ACID transactions</p>
                        <ul>
                            <li>Single source of truth</li>
                            <li>No data synchronization issues</li>
                            <li>Simplified deployment</li>
                            <li>Lower operational costs</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #9b59b6;">
                        <h3>2. Referral System</h3>
                        <p><strong>Flexible relationship management:</strong></p>
                        <ul>
                            <li>Referrer/Referee relationships</li>
                            <li>Commission splitting rules</li>
                            <li>Multi-party referrals</li>
                            <li>Automated referral fees</li>
                            <li>Track referral sources</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #3498db;">
                        <h3>3. Kanban Loan Management</h3>
                        <p><strong>Visual pipeline management:</strong></p>
                        <ul>
                            <li>Drag-drop loan stages</li>
                            <li>Custom workflow states</li>
                            <li>Automated status updates</li>
                            <li>Task assignments</li>
                            <li>SLA tracking</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #2ecc71;">
                        <h3>4. Client Portal</h3>
                        <p><strong>For broker's clients to upload loan documents:</strong></p>
                        <ul>
                            <li>Original loan document uploads</li>
                            <li>Digital signature (DocuSign style)</li>
                            <li>Application status tracking</li>
                            <li>Secure document submission</li>
                            <li>Direct communication with broker</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #f39c12;">
                        <h3>5. Commission Processing</h3>
                        <p><strong>Automated calculations:</strong></p>
                        <ul>
                            <li>Upfront & trail commissions</li>
                            <li>Complex split rules</li>
                            <li>RCTI generation</li>
                            <li>Fee deductions</li>
                            <li>Bulk processing via Excel</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #e67e22;">
                        <h3>6. AI/ML Engine</h3>
                        <p><strong>Intelligent automation & analysis:</strong></p>
                        <ul>
                            <li><strong>AI Loan Summary:</strong> Auto-generate loan summaries from applications</li>
                            <li><strong>Compliance File Generation:</strong> Create regulatory documents automatically</li>
                            <li><strong>Best Interest Duty:</strong> Ensure compliance with regulatory requirements</li>
                            <li><strong>Factfind Extraction:</strong> Extract client information from documents</li>
                            <li><strong>Financial Report Analysis:</strong> Parse bank statements & financial docs</li>
                            <li><strong>Pay Slip Analysis & Info Extraction:</strong> Extract income data automatically</li>
                            <li><strong>Risk Assessment:</strong> AI-powered risk scoring & fraud detection</li>
                            <li><strong>Document Classification:</strong> Auto-categorize uploaded documents</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #1abc9c;">
                        <h3>7. API Integrations</h3>
                        <p><strong>Third-party connections:</strong></p>
                        <ul>
                            <li>Lender APIs</li>
                            <li>Credit check services</li>
                            <li>Identity verification</li>
                            <li>Property valuation</li>
                            <li>Banking data feeds</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #34495e;">
                        <h3>8. Future Extensibility</h3>
                        <p><strong>Built for growth:</strong></p>
                        <ul>
                            <li>JSONB for flexible data</li>
                            <li>Dynamic relationships</li>
                            <li>Unlimited company types</li>
                            <li>Custom workflows</li>
                            <li>Plugin architecture ready</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="diagram-container">
                <h2>Why This Architecture?</h2>
                
                <div class="explanation-box" style="background: #fadbd8; border-left: 4px solid #c62828;">
                    <h3>‚ö†Ô∏è Current System Limitations</h3>
                    <p><strong>Critical issues with the existing microservices architecture:</strong></p>
                    
                    <h4>1. Data Duplication & Inconsistency</h4>
                    <ul>
                        <li>Same broker data exists in 5+ different databases</li>
                        <li>RCTI data scattered across multiple services</li>
                        <li>Data synchronization failures causing inconsistencies</li>
                        <li>No single source of truth for critical business data</li>
                    </ul>
                    
                    <h4>2. Over-Engineered Code</h4>
                    <ul>
                        <li>Most services are AI-generated with excessive complexity</li>
                        <li>Simple CRUD operations have 1000+ lines of boilerplate</li>
                        <li>Difficult to understand and maintain</li>
                        <li>Bug fixes require changes in multiple services</li>
                    </ul>
                    
                    <h4>3. Infrastructure Overkill</h4>
                    <ul>
                        <li><strong>K8s is massively over-provisioned:</strong> CPU usage &lt;20%, Network &lt;20%, DB &lt;20%</li>
                        <li>Managing CSV files in pods is fragile and ugly</li>
                        <li>PostgreSQL running in pods without proper backup</li>
                        <li>Complex orchestration for simple workflows</li>
                    </ul>
                    
                    <h4>4. No Monitoring or Observability</h4>
                    <ul>
                        <li>No centralized monitoring dashboard</li>
                        <li>Cannot track system health or performance</li>
                        <li>Debugging requires checking 11 different log streams</li>
                        <li>No alerting for failures or issues</li>
                    </ul>
                </div>
                
                <div class="explanation-box" style="background: #e8f6f3; border-left: 4px solid #16a085;">
                    <h3>‚úÖ Solution: Monolithic Architecture</h3>
                    <p><strong>How the new architecture addresses these issues:</strong></p>
                    
                    <h4>1. Data Unification</h4>
                    <ul>
                        <li><strong>Before:</strong> 11 databases with duplicated, inconsistent data</li>
                        <li><strong>After:</strong> Single PostgreSQL database with normalized schema</li>
                        <li><strong>Result:</strong> Zero data duplication, 100% consistency</li>
                    </ul>
                    
                    <h4>2. Simplified Codebase</h4>
                    <ul>
                        <li><strong>Before:</strong> Over-complicated AI-generated services</li>
                        <li><strong>After:</strong> Clean, maintainable monolithic codebase</li>
                        <li><strong>Result:</strong> 60% less code, easier to understand and debug</li>
                    </ul>
                    
                    <h4>3. Right-Sized Infrastructure</h4>
                    <ul>
                        <li><strong>Before:</strong> K8s with &lt;20% resource utilization</li>
                        <li><strong>After:</strong> Simple deployment on 2-3 VMs or containers</li>
                        <li><strong>Result:</strong> 80% infrastructure cost reduction</li>
                    </ul>
                    
                    <h4>4. Built-in Monitoring</h4>
                    <ul>
                        <li><strong>Before:</strong> No monitoring or observability</li>
                        <li><strong>After:</strong> Grafana + Prometheus from day one</li>
                        <li><strong>Result:</strong> Full visibility into system health and performance</li>
                    </ul>
                    
                    <h4>5. Additional Benefits</h4>
                    <ul>
                        <li>ACID transactions across all operations</li>
                        <li>No network latency between services</li>
                        <li>Simpler deployment and maintenance</li>
                        <li>Faster development of new features</li>
                        <li>Easy local development environment</li>
                    </ul>
                </div>
            </div>

            <div class="diagram-container">
                <h2>Complete System Architecture</h2>
                <div class="mermaid">
flowchart TB
    subgraph "Layer 1: User Interface"
        direction LR
        Portal[fa:fa-user-circle Client Portal<br/>For Loan Applicants]
        Kanban[fa:fa-columns Kanban Board<br/>For Brokers]
        Dashboard[fa:fa-chart-line Dashboard<br/>For Brokers]
    end
    
    subgraph "Layer 2: Core Features"
        direction LR
        Users[fa:fa-users Users]
        Companies[fa:fa-building Companies]
        Referral[fa:fa-handshake Referrals]
        AI[fa:fa-robot AI Engine<br/>‚Ä¢ Loan Summary<br/>‚Ä¢ Compliance Gen<br/>‚Ä¢ Best Interest Duty<br/>‚Ä¢ Factfind Extract<br/>‚Ä¢ Financial Analysis<br/>‚Ä¢ Pay Slip Analysis]
    end
    
    subgraph "Layer 3: Business Logic"
        direction LR
        Loans[fa:fa-file-invoice Loans]
        Settlements[fa:fa-check Settlements]
        Files[fa:fa-upload File Processing<br/>‚Ä¢ DOCX, PDF, Excel, CSV<br/>‚Ä¢ RCTI from Lenders<br/>‚Ä¢ Multi-format Parsing<br/>‚Ä¢ Data Extraction]
    end
    
    subgraph "Layer 4: Financial Processing"
        direction LR
        Upfront[fa:fa-dollar Upfront Comm.]
        Trail[fa:fa-sync Trail Comm.]
        RCTI[fa:fa-receipt RCTI]
    end
    
    subgraph "Layer 5: Data Storage"
        direction LR
        PG[(PostgreSQL)]
        Mongo[(MongoDB)]
        S3[fa:fa-cloud S3 Storage]
    end
    
    %% Simplified connections between layers
    Portal --> Users
    Kanban --> Loans
    Dashboard --> Loans
    
    Users --> Loans
    Companies --> Loans
    Referral --> Loans
    AI --> Loans
    
    Loans --> Settlements
    Files --> Settlements
    
    Settlements --> Upfront
    Settlements --> Trail
    
    Upfront --> RCTI
    Trail --> RCTI
    
    RCTI --> PG
    Loans --> PG
    Files --> S3
    AI --> Mongo
    
    %% Styles
    classDef uiClass fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef featureClass fill:#e8f8f5,stroke:#00897b,stroke-width:2px
    classDef businessClass fill:#fef9e7,stroke:#f9a825,stroke-width:2px
    classDef financeClass fill:#fdebd0,stroke:#ef6c00,stroke-width:2px
    classDef dataClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    
    class Portal,Kanban,Dashboard uiClass
    class Users,Companies,Referral,AI featureClass
    class Loans,Settlements,Files businessClass
    class Upfront,Trail,RCTI financeClass
    class PG,Mongo,S3 dataClass
                </div>
            </div>

            <div class="summary-box">
                <h3>üìã Implementation Roadmap & Tasks</h3>
                
                <div class="domain-grid">
                    <div class="domain-card" style="border-top: 4px solid #e74c3c;">
                        <h3>Phase 1: UI/UX Design</h3>
                        <h4>Design System & User Experience</h4>
                        <ul>
                            <li>‚¨ú User research & personas</li>
                            <li>‚¨ú Information architecture</li>
                            <li>‚¨ú Wireframes for all modules</li>
                            <li>‚¨ú Design system & component library</li>
                            <li>‚¨ú Kanban board UI design</li>
                            <li>‚¨ú Client portal interface</li>
                            <li>‚¨ú Mobile responsive design</li>
                            <li>‚¨ú Usability testing</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #3498db;">
                        <h3>Phase 2: Database Architecture</h3>
                        <h4>Data Layer Foundation</h4>
                        <ul>
                            <li>‚úÖ Design unified database schema</li>
                            <li>‚úÖ Define all entity relationships</li>
                            <li>‚¨ú Create migration scripts from microservices</li>
                            <li>‚¨ú Set up database indexes and constraints</li>
                            <li>‚¨ú Implement audit logging structure</li>
                            <li>‚¨ú Data deduplication strategy</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #2ecc71;">
                        <h3>Phase 4: Core Migration</h3>
                        <h4>Monolith Development</h4>
                        <ul>
                            <li>‚¨ú User & authentication system</li>
                            <li>‚¨ú Company & role management</li>
                            <li>‚¨ú Loan processing pipeline</li>
                            <li>‚¨ú Commission calculations</li>
                            <li>‚¨ú RCTI generation</li>
                            <li>‚¨ú Data migration & cleanup</li>
                            <li>‚¨ú Remove K8s complexity</li>
                        </ul>
                    </div>

                    <div class="domain-card" style="border-top: 4px solid #e67e22;">
                        <h3>Phase 6: New Features</h3>
                        <h4>Feature Implementation</h4>
                        <ul>
                            <li>‚¨ú Referral system with splits</li>
                            <li>‚¨ú Kanban loan management</li>
                            <li>‚¨ú Client portal & uploads</li>
                            <li>‚¨ú Digital signatures</li>
                            <li>‚¨ú <strong>AI Loan Summary</strong> - Auto-generate comprehensive loan summaries</li>
                            <li>‚¨ú <strong>Compliance File Generation</strong> - Automated regulatory documents</li>
                            <li>‚¨ú <strong>Best Interest Duty</strong> - Compliance checking & recommendations</li>
                            <li>‚¨ú <strong>Factfind Extraction</strong> - Extract client data from documents</li>
                            <li>‚¨ú <strong>Financial Report Analysis</strong> - Parse bank statements automatically</li>
                            <li>‚¨ú <strong>Pay Slip Analysis</strong> - Income verification & extraction</li>
                            <li>‚¨ú Advanced file processing (DOCX, PDF, Excel, CSV, RCTI)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="section" style="text-align: center; margin-top: 50px; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px;">
            <h2 style="color: white; border: none;">üö¢ HarbourX - Navigating Financial Success</h2>
            <p style="font-size: 1.2em; margin: 20px 0;">Complete system design combining database architecture and feature specifications</p>
            <p style="opacity: 0.9;">¬© 2024 HarbourX - Combined Design Document v1.0</p>
        </div>
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                padding: 20,
                nodeSpacing: 50,
                rankSpacing: 80
            },
            er: {
                layoutDirection: 'TB',
                minEntityWidth: 100,
                minEntityHeight: 75,
                entityPadding: 15,
                stroke: '#333',
                fill: '#fff'
            },
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#5a67d8',
                lineColor: '#333',
                sectionBkgColor: '#f7fafc',
                altSectionBkgColor: '#edf2f7',
                gridColor: '#e2e8f0',
                cScale0: '#667eea',
                cScale1: '#764ba2',
                cScale2: '#3498db'
            }
        });
    </script>
</body>
</html>